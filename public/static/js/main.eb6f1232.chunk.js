(this["webpackJsonpvrpacs-video-conference"]=this["webpackJsonpvrpacs-video-conference"]||[]).push([[0],{226:function(e,t,r){},227:function(e,t,r){},228:function(e,t,r){},229:function(e,t,r){},230:function(e,t,r){},231:function(e,t,r){},232:function(e,t,r){},233:function(e,t,r){},234:function(e,t,r){},235:function(e,t,r){},236:function(e,t,r){},369:function(e,t,r){"use strict";r.r(t);var n=r(28),o=r.n(n),a=r(7),c=r.n(a),s=r(9),i=r(11),u=r(13),d=r(15),l=r(14),p=r(0),f=r.n(p),m=r(29),h="ERROR_BOUDRY",v={show:!1,error:""},b=function(e){return{type:h,payload:e}},j=r(4),O=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={},e}return Object(u.a)(r,[{key:"render",value:function(){var e=this.props.errorBoundryState;return e.show&&e.error?Object(j.jsx)("div",{}):null}}]),r}(p.Component);var x,g,w,y=Object(m.b)((function(e){return{errorBoundryState:e.errorBoundryState}}),(function(e){return{setErrorBoundry:function(t){return e(b(t))}}}))(O),k=(r(225),r(226),r(227),r(228),r(229),r(230),r(231),r(232),r(233),r(234),r(235),r(236),{risServerUrl:"",socketServerUrl:"",scuServerUrl:"",hospitalLogo:"",hospitalName:"",hospitalAddress:""}),S=r(97),C=r.n(S),I=r(101),R=r(190),T="AUTHENTICATE",N="LIST_SRC_VIDEO",U=[],E=function(e){return{type:N,payload:e}},M="SET_LOCAL_AUDIO_INPUT",P="SET_LOCAL_STREAMS",D=[],A="SET_LOCAL_VIDEO_INPUT",V="SET_MESSAGE",_=[],L=function(e){return{type:V,payload:e}},B=function(){return function(){var e=Object(s.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.post("/call/getMessageInRoom",{roomname:window.roomClient.roomname});case 2:return r=e.sent,e.abrupt("return",t(L(r.data)));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},F="SET_MIC_OPEN",z=function(e){return{type:F,payload:e}},K="SET_MODAL_SETTING_VISIBLE",H=function(e){return{type:K,payload:e}},W="SET_SIDER_ACTIVE",Y="users",G=function(e){return{type:W,payload:e}},q="SET_VIDEO_OPEN",J=function(e){return{type:q,payload:e}},Q=r(204),X="SET_CONSUMERS",Z=[],$=function(){var e=Object(s.a)(c.a.mark((function e(t){var r,n,o,a,s,i,u,d,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=0;case 2:if(!(n<t.length)){e.next=21;break}o=t[n],a=0;case 5:if(!(a<o.listProducer.length)){e.next=18;break}return s=o.listProducer[a],i=window.roomClient,e.next=10,i.getConsumerFromProducerId(s.producerId);case 10:u=e.sent,(d=new MediaStream).addTrack(u.track),l={producerId:s.producerId,producerType:s.producerType,stream:d,type:o.userId===window.roomClient.localUser.id?"localUser":"remoteUser",active:!1,activeMain:!1,userId:o.userId,consumerId:u.id,username:o.username},r.push(l);case 15:a++,e.next=5;break;case 18:n++,e.next=2;break;case 21:return e.abrupt("return",r);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ee="SET_USERS",te=[],re=function(){return function(){var e=Object(s.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.post("/call/getConsumerUser",{roomname:window.roomClient.roomname});case 2:return r=e.sent,e.next=5,t((n=r.data,{type:ee,payload:n}));case 5:case"end":return e.stop()}var n}),e)})));return function(t){return e.apply(this,arguments)}}()},ne="SET_LOCAL_PRODUCER",oe=[],ae=function(e){return{type:ne,payload:e}},ce="SET_PAGE",se=function(e){return{type:ce,payload:e}},ie=Object(I.b)({errorBoundryState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:return e=t.payload;default:return e}},isAuthenticate:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:return e=t.payload;default:return e}},messageState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case V:return e=t.payload;default:return e}},listSrcVideo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case N:return e=t.payload;default:return e}},localStreams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return e=t.payload;default:return e}},modalSettingVisible:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case K:return e=t.payload;default:return e}},localAudioInput:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M:return e=t.payload;default:return e}},localVideoInput:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case A:return e=t.payload;default:return e}},videoOpen:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case q:return e=t.payload;default:return e}},micOpen:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return e=t.payload;default:return e}},siderActive:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case W:return e=t.payload;default:return e}},consumers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case X:return e=t.payload,Object(Q.a)(e);default:return e}},listUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ee:return e=t.payload;default:return e}},localProducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ne:return e=t.payload;default:return e}},pageReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ce:return e=t.payload;default:return e}}}),ue=[R.a],de=Object(I.c)(ie,I.a.apply(void 0,ue)),le=6e6,pe=function(){var e=Object(s.a)(c.a.mark((function e(){var t,r,n,o,a,s,i,u,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={audio:!0,video:!0},e.next=3,window.navigator.mediaDevices.getUserMedia(t);case 3:return e.sent,e.next=6,window.navigator.mediaDevices.enumerateDevices();case 6:for(r=e.sent,n=[],o=0;o<r.length;o++)a=r[o],s=a.kind,i=a.label,u=a.deviceId,"videoinput"!==s&&"audioinput"!==s||(d={name:i,active:"default"===u,type:s,deviceId:u,producer:null},n.push(d));de.dispatch(ae(n));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),fe=r(372),me=r(371),he=r(377),ve=r(210),be=r(379),je=r(376),Oe=r(116),xe=r.n(Oe),ge=function(e){return function(){var t=Object(s.a)(c.a.mark((function t(r){var n,o;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.post("/call/getConsumerUser",{roomname:e});case 2:return n=t.sent,de.dispatch((r=n.data,{type:X,payload:r})),t.next=6,$(n.data);case 6:o=t.sent,de.dispatch(E(o));case 8:case"end":return t.stop()}var r}),t)})));return function(e){return t.apply(this,arguments)}}()},we=null,ye=null,ke=function(){var e=Object(s.a)(c.a.mark((function e(t){var r,n,o,a,s,i,u,d,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.filter((function(e){return"videoinput"===e.type})),n=r.find((function(e){return!0===e.active}))||r[0]){e.next=4;break}return e.abrupt("return");case 4:if(!we){e.next=7;break}return e.next=7,window.roomClient.localUser.closeProducer(we.producer.id);case 7:return o=window.roomClient,a=o.localUser,s={video:{deviceId:n.deviceId?{exact:n.deviceId}:void 0},audio:!1},i=navigator.mediaDevices,e.next=13,i.getUserMedia(s);case 13:return u=e.sent,d=u.getVideoTracks()[0],e.next=17,null===a||void 0===a?void 0:a.produce(o.routerCapabilities,o.producerTransport,d,"camera");case 17:return l=e.sent,we={producer:l,deviceId:n.deviceId},n.active=!0,n.producer=l,e.next=23,de.dispatch(ae(t));case 23:return e.next=25,de.dispatch(re());case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Se=function(){var e=Object(s.a)(c.a.mark((function e(t){var r,n,o,a,s,i,u,d,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.filter((function(e){return"audioinput"===e.type})),n=r.find((function(e){return!0===e.active}))||r[0]){e.next=4;break}return e.abrupt("return");case 4:if(console.log(n),!ye){e.next=8;break}return e.next=8,window.roomClient.localUser.closeProducer(ye.producer.id);case 8:return o=window.roomClient,a=o.localUser,s={audio:{deviceId:n.deviceId?{exact:n.deviceId}:void 0},video:!1},i=navigator.mediaDevices,e.next=14,i.getUserMedia(s);case 14:return u=e.sent,d=u.getAudioTracks()[0],e.next=18,null===a||void 0===a?void 0:a.produce(o.routerCapabilities,o.producerTransport,d,"audio");case 18:return l=e.sent,ye={producer:l,deviceId:n.deviceId},n.active=!0,n.producer=l,e.next=24,de.dispatch(ae(t));case 24:return e.next=26,de.dispatch(re());case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ce=function(){var e=Object(s.a)(c.a.mark((function e(){var t,r,n,o,a,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.roomClient,r=t.localUser,n={video:!0,audio:!1},o=navigator.mediaDevices,e.next=6,o.getDisplayMedia(n);case 6:return a=e.sent,s=a.getVideoTracks()[0],e.next=10,null===r||void 0===r?void 0:r.produce(t.routerCapabilities,t.producerTransport,s,"screenshare");case 10:return e.sent,e.next=13,de.dispatch(re());case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=r(202),Re=r(154),Te=r.n(Re),Ne={roomName:"",roomKey:"",username:"",sid:-1},Ue=null,Ee=[],Me=function(){var e=Object(s.a)(c.a.mark((function e(t){var r,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=window.MediaRecorder.isTypeSupported("video/webm; codecs=vp9")?"video/webm; codecs=vp9":"video/webm",(n=new window.MediaRecorder(t,{mimeType:r})).ondataavailable=function(e){e.data.size>0&&Ee.push(e.data)},n.onstop=Object(s.a)(c.a.mark((function e(){var t,r,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Blob(Ee,{type:Ee[0].type}),r=new File([t],Te()().format("HH-mm.DD-MM-YYYY")+".webm"),(n=new FormData).append("files",r),e.next=6,g.post("vrpacs-file/study-upload-file?sID=".concat(Ne.sid,"&seName=NonDicom&description=upload_").concat(Te()().format("DD-MM-YYYY")),n);case 6:1===e.sent.status?Ie.b.success("Success!"):Ie.b.error("error!"),Ee=[];case 9:case"end":return e.stop()}}),e)}))),n.start(),Ue=n;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Pe=function(){var e=Object(s.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ue&&(Ue.stop(),Ue.stream.getTracks().forEach((function(e){e.stop()})),console.log(Ue));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),De=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={},e.componentDidMount=function(){e.props.name},e.componentDidUpdate=function(t){e.props.name;t.name},e}return Object(u.a)(r,[{key:"render",value:function(){var e=this.props,t=e.name,r=e.style;return Object(j.jsx)("i",{className:t,style:r})}}]),r}(p.Component),Ae=Object(j.jsx)(he.a,{children:Object(j.jsx)(he.a.Item,{onClick:function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()},children:"To\xe0n m\xe0n h\xecnh"})}),Ve=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={showButtonDropdown:!1,recordStart:!1},e.timer=null,e.onOpenSharescreen=Object(s.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ce();case 1:case"end":return e.stop()}}),e)}))),e.onOpenCamera=function(){var t=Object(s.a)(c.a.mark((function t(r){var n,o,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.props.localProducer,o=n.filter((function(e){return"videoinput"===e.type})),a=o.find((function(e){return!0===e.active}))||o[0]){t.next=5;break}return t.abrupt("return");case 5:return a.producer?a.producer&&!0===r?(a.producer.producer.resume(),console.log("remuse",a.producer)):(a.producer.producer.pause(),console.log("pause")):(console.log("create"),ke(n)),t.next=8,e.props.setVideoOpen(r);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.onOpenMic=function(){var t=Object(s.a)(c.a.mark((function t(r){var n,o,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.props.localProducer,o=n.filter((function(e){return"audioinput"===e.type})),a=o.find((function(e){return!0===e.active}))||o[0]){t.next=5;break}return t.abrupt("return");case 5:return a.producer?a.producer&&!0===r?(a.producer.producer.resume(),console.log("remuse",a.producer)):(a.producer.producer.pause(),console.log("pause")):(console.log("create"),Se(n)),t.next=8,e.props.setMicOpen(r);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.onRecord=Object(s.a)(c.a.mark((function t(){var r,n,o,a,s,i,u,d,l,p;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(p=function(e){var t=e+"";return t.length<2?"0"+t:t},l=function(){++d,n&&r&&(console.log(p(d%60)+":"+p(Math.floor(d/60))),n.innerHTML=p(d%60),r.innerHTML=p(Math.floor(d/60))+":")},r=document.getElementById("minutes-count"),n=document.getElementById("seconds-count"),e.state.recordStart){t.next=21;break}return console.log("Start"),a=e.props.localProducer,s=null===(o=a.filter((function(e){return e.active&&"audioinput"===e.type}))[0])||void 0===o?void 0:o.deviceId,t.next=10,navigator.mediaDevices.getUserMedia({audio:{deviceId:s?{exact:s}:void 0}});case 10:return i=t.sent,t.next=13,navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});case 13:u=t.sent,d=0,e.timer=setInterval(l,1e3),i.getAudioTracks().forEach((function(e){u.addTrack(e)})),console.log(u.getAudioTracks().forEach((function(e){console.log(e)}))),Me(u),t.next=25;break;case 21:console.log("Stop"),n&&r&&(n.innerHTML="",r.innerHTML=""),clearInterval(e.timer),Pe();case 25:e.setState({recordStart:!e.state.recordStart});case 26:case"end":return t.stop()}}),t)}))),e}return Object(u.a)(r,[{key:"render",value:function(){var e=this,t=this.state,r=t.showButtonDropdown,n=t.recordStart,o=this.props,a=o.micOpen,c=o.videoOpen,s=o.siderActive,i=o.messageState,u=o.listUser;return Object(j.jsxs)("div",{className:"home-footer",children:[Object(j.jsx)(xe.a,{onResize:function(t){t.width<769?e.setState({showButtonDropdown:!0}):e.setState({showButtonDropdown:!1})}}),Object(j.jsxs)("div",{className:"wrapper-left",children:[Object(j.jsx)(ve.a,{title:"Ch\u1ecdn camera",children:Object(j.jsx)("button",{onClick:function(){return e.props.setModalSettingVisible(!0)},children:Object(j.jsx)(De,{name:"fal fa-cog",style:{}})})}),!r&&Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("div",{style:{width:1,height:16,background:"#dadce0",margin:"0 6px"}}),Object(j.jsx)("div",{className:"room-name",children:window.roomClient.roomname})]})]}),Object(j.jsxs)("div",{style:{flex:1,justifyContent:"center"},children:[a?Object(j.jsx)(ve.a,{title:"T\u1eaft micro",children:Object(j.jsx)("button",{className:"circle",onClick:function(){return e.onOpenMic(!1)},children:Object(j.jsx)(De,{style:{},name:"fal fa-microphone"})})}):Object(j.jsx)(ve.a,{title:"B\u1eadt micro",children:Object(j.jsx)("button",{className:"circle",onClick:function(){return e.onOpenMic(!0)},children:Object(j.jsx)(De,{style:{},name:"fal fa-microphone-slash"})})}),c?Object(j.jsx)(ve.a,{title:"T\u1eaft camera",children:Object(j.jsx)("button",{className:"circle",onClick:function(){return e.onOpenCamera(!1)},children:Object(j.jsx)(De,{style:{},name:"fal fa-video"})})}):Object(j.jsx)(ve.a,{title:"B\u1eadt camera",children:Object(j.jsx)("button",{className:"circle",onClick:function(){return e.onOpenCamera(!0)},children:Object(j.jsx)(De,{style:{},name:"fal fa-video-slash"})})}),Object(j.jsx)(ve.a,{title:"Share screen",children:Object(j.jsx)("button",{className:"circle",onClick:function(){return e.onOpenSharescreen()},children:Object(j.jsx)(De,{style:{},name:"fal fa-desktop"})})}),n?Object(j.jsx)(ve.a,{title:"Record stop",children:Object(j.jsx)("button",{style:{fontSize:12,background:"tomato"},className:"circle",onClick:function(){return e.onRecord()},children:Object(j.jsx)(De,{style:{fontSize:18},name:"fal fa-stop"})})}):Object(j.jsx)(ve.a,{title:"Record start",children:Object(j.jsx)("button",{className:"circle",onClick:function(){return e.onRecord()},children:Object(j.jsx)(De,{style:{fontSize:18},name:"fal fa-play"})})}),Object(j.jsx)(be.a,{overlay:Ae,trigger:["click"],children:Object(j.jsx)("button",{className:"circle",children:Object(j.jsx)(De,{style:{},name:"fal fa-ellipsis-v-alt"})})}),Object(j.jsx)(ve.a,{title:"R\u1eddi kh\u1ecfi cu\u1ed9c g\u1ecdi",children:Object(j.jsx)("button",{className:"end-call",children:Object(j.jsx)(De,{style:{},name:"fal fa-phone-alt"})})})]}),Object(j.jsx)("div",{children:Object(j.jsxs)(j.Fragment,{children:[!r&&Object(j.jsx)(ve.a,{placement:"topRight",title:"Hi\u1ec3n th\u1ecb t\u1ea5t c\u1ea3 m\u1ecdi ng\u01b0\u1eddi",children:Object(j.jsx)(je.a,{size:"default",count:u.length,overflowCount:99,style:{backgroundColor:"#52c41a"},children:Object(j.jsx)("button",{onClick:function(){"users"!==s?e.props.setSiderActive("users"):e.props.setSiderActive("none")},children:Object(j.jsx)(De,{style:{color:"#fff"},name:"fal fa-users"})})})}),Object(j.jsx)(ve.a,{placement:"topRight",title:"Tr\xf2 chuy\u1ec7n v\u1edbi m\u1ecdi ng\u01b0\u1eddi",children:Object(j.jsx)(je.a,{size:"default",count:i.length,overflowCount:10,children:Object(j.jsx)("button",{onClick:function(){"chat"!==s?e.props.setSiderActive("chat"):e.props.setSiderActive("none")},children:Object(j.jsx)(De,{style:{color:"#fff"},name:"fal fa-comment-alt-dots"})})})})]})})]})}}]),r}(p.Component),_e=Object(m.b)((function(e){return{listUser:e.listUser,micOpen:e.micOpen,videoOpen:e.videoOpen,siderActive:e.siderActive,localAudioInput:e.localAudioInput,localProducer:e.localProducer,listSrcVideo:e.listSrcVideo,messageState:e.messageState}}),(function(e){return{setModalSettingVisible:function(t){return e(H(t))},setVideoOpen:function(t){return e(J(t))},setMicOpen:function(t){return e(z(t))},setSiderActive:function(t){return e(G(t))},getConsumersFromServer:function(t){return e(ge(t))}}}))(Ve),Le=r(209),Be=r(193),Fe=r(199),ze="disconnect",Ke="SOCKET_USER_LEFT_ROOM",He="SOCKET_USER_JOIN_ROOM",We="INCOMMING_MESSAGE",Ye="NEW_PRODUCER",Ge="CLOSE_CONSUME",qe=function(e,t){Le.a[e]({message:"Th\xf4ng b\xe1o!",description:t,placement:"bottomRight"})},Je="audio",Qe="video",Xe=function e(t,r,n,o,a){var u=this;Object(i.a)(this,e),this.socket=void 0,this.id=void 0,this.username=void 0,this.iskey=void 0,this.roomname=void 0,this.produce=function(){var e=Object(s.a)(c.a.mark((function e(t,r,n,o){var a,i,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.getTrackParamsCodec(t,n),e.next=3,r.produce(a);case 3:return(i=e.sent).type=o,i.on("trackended",Object(s.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={kind:i.kind,id:i.id,producer:i},e.next=3,u.closeProducer(t.id);case 3:case"end":return e.stop()}}),e)})))),i.on("transportclose",(function(){console.log("producer transport close")})),i.on("close",(function(){console.log("closing producer")})),d={kind:i.kind,id:i.id,producer:i},e.abrupt("return",d);case 10:case"end":return e.stop()}}),e)})));return function(t,r,n,o){return e.apply(this,arguments)}}(),this.consumer=function(){var e=Object(s.a)(c.a.mark((function e(t,r,n,o,a){var s,i,u,d,l,p,f;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.post("/call/createConsumer",{roomname:t,userId:r,consumerParams:{rtpCapabilities:n,consumerTransportId:o.id,producerId:a}});case 2:return s=e.sent,i=s.data.params,u=i.id,d=i.kind,l=i.rtpParameters,p={},e.next=7,o.consume({id:u,producerId:a,kind:d,rtpParameters:l,codecOptions:p});case 7:return f=e.sent,e.abrupt("return",f);case 9:case"end":return e.stop()}}),e)})));return function(t,r,n,o,a){return e.apply(this,arguments)}}(),this.getTrackParamsCodec=function(e,t){switch(t.kind){case Qe:return{track:t,codec:e.codecs.find((function(e){return"video/vp8"===e.mimeType.toLowerCase()})),encodings:[{scaleResolutionDownBy:1,maxBitrate:1e7},{scaleResolutionDownBy:1,maxBitrate:11e6},{scaleResolutionDownBy:1,maxBitrate:11e6}],codecOptions:{videoGoogleStartBitrate:1e3}};case Je:return{track:t,codec:e.codecs.find((function(e){return"audio/opus"===e.mimeType.toLowerCase()}))}}},this.closeProducer=function(){var e=Object(s.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,x.post("/call/closeProducer",{roomname:u.roomname,userId:u.id,producerParams:{producerId:t}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.closeProducerWithType=function(){var e=Object(s.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.closeConsumer=function(){var e=Object(s.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.closeAddConsumerOfUser=function(e){},this.socket=t,this.id=r,this.username=n,this.iskey=o,this.roomname=a};!function(e){e.producer="producer",e.consumer="consumer"}(w||(w={}));var Ze=function e(t,r,n,o){var a=this;Object(i.a)(this,e),this.roomname=void 0,this.password=void 0,this.username=void 0,this.socket=void 0,this.localUser=void 0,this.device=void 0,this.producerTransport=void 0,this.consumerTransport=void 0,this.routerCapabilities=void 0,this.initSocketEvent=function(){a.socket.on(Ye,function(){var e=Object(s.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("NEW_PRODUCER"),e.next=3,de.dispatch(re());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.socket.on(Ge,function(){var e=Object(s.a)(c.a.mark((function e(t){var r,n,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.consumerId,n=t.peerId,o=t.peerName,console.log("closing consumer:",r,n,o),e.next=4,de.dispatch(re());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.socket.on(Ke,function(){var e=Object(s.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.name,t.id,t.isKey,de.dispatch(re()),qe("warning",r+" \u0111\xe3 r\u1eddi kh\u1ecfi cu\u1ed9c h\u1ecdp");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.socket.on(He,function(){var e=Object(s.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,t.id,e.next=3,de.dispatch(re());case 3:qe("info",r+" \u0111\xe3 tham gia v\xe0o cu\u1ed9c h\u1ecdp");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.socket.on(We,(function(e){de.dispatch(L(e))})),a.socket.on(ze,(function(){a.exit(!1)}))},this.exit=Object(s.a)(c.a.mark((function e(){var t,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.length>0&&void 0!==r[0]&&r[0]){e.next=4;break}return e.next=4,x.post("/call/exitRoom",{roomname:a.roomname,userId:null===(t=a.localUser)||void 0===t?void 0:t.id});case 4:a.consumerTransport.close(),a.producerTransport.close(),a.socket.off(He),a.socket.off(Ke),a.socket.off(ze),a.socket.off(Ge),a.socket.off(Ye),window.close();case 12:case"end":return e.stop()}}),e)}))),this.init=Object(s.a)(c.a.mark((function e(){var t,r,n,o,i,u,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Xe(a.socket,a.socket.id,a.username,!0,a.roomname),e.next=3,x.post("/call/checkRoomExistence",{roomname:a.roomname});case 3:if(!e.sent){e.next=16;break}return t.iskey=!1,e.next=8,a.joinRoom(t);case 8:if(1===(r=e.sent).status){e.next=13;break}return Le.a.error({message:r.message}),de.dispatch(se("login")),e.abrupt("return");case 13:console.log("join room"),e.next=24;break;case 16:return t.iskey=!0,e.next=19,a.createRoom(t);case 19:if(1===(n=e.sent).status){e.next=23;break}return Le.a.error({message:n.message}),e.abrupt("return");case 23:console.log("create room");case 24:return e.next=26,x.post("/call/getRouterCapacities",{roomname:a.roomname});case 26:return o=e.sent,i=o.data,e.next=30,a.loadDevice(i);case 30:return a.device=e.sent,e.next=33,a.initTransports(a.device,w.producer);case 33:return(u=e.sent).on("connect",function(){var e=Object(s.a)(c.a.mark((function e(t,r,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x.post("/call/connectTransport",{roomname:a.roomname,userId:a.socket.id,connectTransport:{dtlsParameters:t.dtlsParameters,transportId:u.id}});case 3:r(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r,n){return e.apply(this,arguments)}}()),u.on("produce",function(){var e=Object(s.a)(c.a.mark((function e(t,r,n){var o,s,i,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=t.kind,s=t.rtpParameters,e.next=4,x.post("/call/createProducer",{roomname:a.roomname,userId:a.socket.id,producerParams:{producerTransportId:u.id,kind:o,rtpParameters:s}});case 4:i=e.sent,d=i.data,r({id:d}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}()),e.next=38,a.initTransports(a.device,w.consumer);case 38:(d=e.sent).on("connect",function(){var e=Object(s.a)(c.a.mark((function e(t,r,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x.post("/call/connectTransport",{roomname:a.roomname,userId:a.socket.id,connectTransport:{dtlsParameters:t.dtlsParameters,transportId:d.id}});case 3:r(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n(n);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r,n){return e.apply(this,arguments)}}()),a.producerTransport=u,a.consumerTransport=d,a.routerCapabilities=i,a.localUser=t;case 44:case"end":return e.stop()}}),e)}))),this.getConsumerFromProducerId=function(){var e=Object(s.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.localUser){e.next=3;break}return console.log("not found user in room"),e.abrupt("return");case 3:return e.next=5,a.localUser.consumer(a.roomname,a.localUser.id,a.device.rtpCapabilities,a.consumerTransport,t);case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getProducerInRoom=Object(s.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.post("/call/getProducerInRoom",{roomname:a.roomname});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),this.createRoom=function(){var e=Object(s.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.post("/call/createRoom",{roomname:a.roomname,password:a.password,userId:t.id,username:t.username});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.joinRoom=function(){var e=Object(s.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.post("/call/joinRoom",{roomname:a.roomname,password:a.password,userId:t.id,username:t.username});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.loadDevice=function(){var e=Object(s.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{r=new Be.Device}catch(n){"UnsupportedError"===n.name&&console.error("browser not supported"),console.error(n)}return e.next=3,r.load({routerRtpCapabilities:t});case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.initTransports=function(){var e=Object(s.a)(c.a.mark((function e(t,r){var n,o,s,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.roomname,o=a.socket.id,e.next=4,x.post("/call/createTransport",{roomname:n,userId:o});case 4:if(1!==(s=e.sent).status){e.next=8;break}return i=r==w.producer?t.createSendTransport(s.data):t.createRecvTransport(s.data),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.roomname=t,this.password=r,this.username=n,this.socket=Object(Fe.a)(k.socketServerUrl),this.socket.on("connect",(function(){o(a)})),this.localUser=null},$e=r(373),et=r(375),tt=r(54),rt=r(378),nt=r(380),ot=$e.a.Option,at=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).handleOk=Object(s.a)(c.a.mark((function t(){var r,n,o,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.props,n=r.videoOpen,o=r.micOpen,a=r.localProducer,console.log(n),n&&ke(a),o&&Se(a),e.props.setModalSettingVisible(!1);case 5:case"end":return t.stop()}}),t)}))),e.handleCancel=function(){e.props.setModalSettingVisible(!1)},e.onChangeVideoDevice=function(t){var r=e.props.localProducer;r.map((function(e){e.deviceId===t?e.active=!0:e.active=!1})),e.props.setLocalProducer(r)},e.onChangeAudioDevice=function(t){var r=e.props.localProducer;r.map((function(e){e.deviceId===t?e.active=!0:e.active=!1})),e.props.setLocalProducer(r)},e}return Object(u.a)(r,[{key:"render",value:function(){var e,t,r=this.props,n=r.modalSettingVisible,o=(r.localStreams,r.localVideoInput,r.localAudioInput,r.micOpen,r.videoOpen,r.localProducer),a=[],c=[];return o.forEach((function(e){"audioinput"===e.type?c.push(e):"videoinput"===e.type&&a.push(e)})),Object(j.jsxs)(et.a,{title:"C\u1ea5u h\xecnh Camera v\xe0 Micro",closable:!1,width:420,className:"modal-setting-camera",visible:n,footer:[Object(j.jsx)(tt.a,{type:"primary",onClick:this.handleOk,children:"L\u01b0u"},"submit"),Object(j.jsx)(tt.a,{type:"primary",danger:!0,onClick:this.handleCancel,children:"\u0110\xf3ng"},"close")],children:[Object(j.jsxs)(rt.a,{className:"wrapper-input",children:[Object(j.jsx)(nt.a,{span:24,children:"Micro"}),Object(j.jsx)(nt.a,{span:24,children:Object(j.jsx)($e.a,{defaultValue:null===(e=c.find((function(e){return"default"===e.deviceId})))||void 0===e?void 0:e.deviceId,style:{width:"100%"},onChange:this.onChangeAudioDevice,children:c.map((function(e,t){return Object(j.jsx)(ot,{value:e.deviceId,children:e.name},t)}))})})]}),Object(j.jsxs)(rt.a,{style:{marginTop:20},className:"wrapper-input",children:[Object(j.jsx)(nt.a,{span:24,children:"Camera"}),Object(j.jsx)(nt.a,{span:24,children:Object(j.jsx)($e.a,{defaultValue:null===(t=a.find((function(e){return"default"===e.deviceId})))||void 0===t?void 0:t.deviceId,style:{width:"100%"},onChange:this.onChangeVideoDevice,children:a.map((function(e,t){return Object(j.jsx)(ot,{value:e.deviceId,children:e.name},t)}))})})]})]})}}]),r}(p.Component),ct=Object(m.b)((function(e){return{localProducer:e.localProducer,modalSettingVisible:e.modalSettingVisible,localStreams:e.localStreams,localAudioInput:e.localAudioInput,localVideoInput:e.localVideoInput,micOpen:e.micOpen,videoOpen:e.videoOpen,listSrcVideo:e.listSrcVideo}}),(function(e){return{setLocalProducer:function(t){return e(ae(t))},setModalSettingVisible:function(t){return e(H(t))},getConsumersFromServer:function(t){return e(ge(t))},setLocalAudioInput:function(t){return e({type:M,payload:t})},setLocalVideoInput:function(t){return e({type:A,payload:t})},setVideoOpen:function(t){return e(J(t))},setMicOpen:function(t){return e(z(t))}}}))(at),st=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={},e}return Object(u.a)(r,[{key:"render",value:function(){this.props.listSrcVideo.filter((function(e){return"localUser"===e.type}));return Object(j.jsxs)("div",{className:"home-main",style:{width:"100%",height:"100%",border:"1px solid orange",padding:5,display:"flex",justifyContent:"center",alignItems:"center",position:"relative"},children:[Object(j.jsx)("video",{poster:"./images/poster.jpg",id:"main-video-element",style:{width:"100%",height:"100%",objectFit:"contain"},autoPlay:!0,muted:!0}),Object(j.jsxs)("div",{style:{height:25,lineHeight:"25px",background:"transparent",position:"absolute",bottom:0,left:0,padding:"0 5px"},children:[Object(j.jsx)("span",{id:"minutes-count"}),Object(j.jsx)("span",{id:"seconds-count"})]})]})}}]),r}(p.Component),it=Object(m.b)((function(e){return{listSrcVideo:e.listSrcVideo}}),{})(st),ut=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).videoRef=void 0,n.componentDidMount=Object(s.a)(c.a.mark((function e(){var t,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.producer,console.log("componentDidMount",t.producerId,n.videoRef),e.next=4,n.producerToConsumer(t.producerId);case 4:r=e.sent,r.consumer,o=r.stream,n.videoRef&&(console.log(o),n.stopStream(),n.videoRef.srcObject=o);case 8:case"end":return e.stop()}}),e)}))),n.shouldComponentUpdate=function(e){var t=n.props.producer;return console.log("shouldComponentUpdate",t.producerId!==e.producer.producerId),t.producerId!==e.producer.producerId},n.componentDidUpdate=function(){var e=Object(s.a)(c.a.mark((function e(t){var r,o,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.props.producer,console.log("componentDidUpdate",r.producerId!==t.producer.producerId),r.producerId===t.producer.producerId){e.next=10;break}return n.stopStream(),e.next=6,n.producerToConsumer(r.producerId);case 6:o=e.sent,o.consumer,a=o.stream,n.videoRef&&(n.videoRef.srcObject=a);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.componentWillUnmount=function(){var e=n.props.producer;n.stopStream(),console.log("componentWillUnmount",e.producerId)},n.stopStream=function(){if(n.videoRef){var e=n.videoRef.srcObject;if(e)e.getTracks().forEach((function(e){e.stop()}))}},n.producerToConsumer=function(){var e=Object(s.a)(c.a.mark((function e(t){var r,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.roomClient.getConsumerFromProducerId(t);case 2:return r=e.sent,console.log(r.track),(n=new MediaStream).addTrack(r.track),e.abrupt("return",{consumer:r,stream:n});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.setMainVideoSrc=function(){for(var e,t=document.getElementById("main-video-element"),r=document.querySelectorAll(".producer-to-consumer"),o=0;o<r.length;o++){r[o].classList.remove("active")}(n.videoRef&&n.videoRef.classList.add("active"),t)&&(t.srcObject=null===(e=n.videoRef)||void 0===e?void 0:e.srcObject)},n.videoRef=null,n}return Object(u.a)(r,[{key:"render",value:function(){var e=this;return Object(j.jsx)("div",{className:"wrapper-video ",children:Object(j.jsx)("video",{className:"producer-to-consumer",onClick:this.setMainVideoSrc,id:this.props.producer.producerId,autoPlay:!0,muted:!0,style:{float:"left",width:"100%",height:"100%",objectFit:"contain"},ref:function(t){e.videoRef=t}})})}}]),r}(p.Component),dt=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).audioRef=void 0,n.componentDidMount=Object(s.a)(c.a.mark((function e(){var t,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.producer,console.log("componentDidMount",t.producerId),e.next=4,n.producerToConsumer(t.producerId);case 4:r=e.sent,r.consumer,o=r.stream,n.audioRef&&(n.stopStream(),n.audioRef.srcObject=o);case 8:case"end":return e.stop()}}),e)}))),n.shouldComponentUpdate=function(e,t){var r=n.props.producer;return console.log("shouldComponentUpdate",r.producerId!==e.producer.producerId),console.log("shouldComponentUpdate nextState",t),r.producerId!==e.producer.producerId},n.componentDidUpdate=function(){var e=Object(s.a)(c.a.mark((function e(t){var r,o,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.props.producer,console.log("componentDidUpdate",r.producerId!==t.producer.producerId),r.producerId===t.producer.producerId){e.next=10;break}return n.stopStream(),e.next=6,n.producerToConsumer(r.producerId);case 6:o=e.sent,o.consumer,a=o.stream,n.audioRef&&(n.audioRef.srcObject=a);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.componentWillUnmount=function(){var e=n.props.producer;n.stopStream(),console.log("componentWillUnmount",e.producerId)},n.stopStream=function(){if(n.audioRef){var e=n.audioRef.srcObject;if(e)e.getTracks().forEach((function(e){e.stop()}))}},n.producerToConsumer=function(){var e=Object(s.a)(c.a.mark((function e(t){var r,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.roomClient.getConsumerFromProducerId(t);case 2:return r=e.sent,(n=new MediaStream).addTrack(r.track),e.abrupt("return",{consumer:r,stream:n});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.onMute=function(){var e=document.getElementById("btn-on-mic"),t=document.getElementById("btn-off-mic");if(e&&t){var r;if(n.audioRef)n.audioRef.muted=!(null===(r=n.audioRef)||void 0===r?void 0:r.muted);-1!==e.className.indexOf("hidden")?(e.className="btn-audio",t.className="btn-audio hidden"):(e.className="btn-audio hidden",t.className="btn-audio")}},n.audioRef=null,n.state={mute:!1},n}return Object(u.a)(r,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{children:[Object(j.jsx)("button",{className:"btn-audio hidden",id:"btn-on-mic",onClick:this.onMute,children:Object(j.jsx)("i",{className:"fal fa-volume-slash"})}),Object(j.jsx)("button",{className:"btn-audio ",id:"btn-off-mic",onClick:this.onMute,children:Object(j.jsx)("i",{className:"fal fa-volume-up"})}),Object(j.jsx)("audio",{autoPlay:!0,muted:!1,style:{display:"none",width:"100%",height:"100%",objectFit:"contain"},ref:function(t){e.audioRef=t}})]})}}]),r}(p.Component),lt=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={},e}return Object(u.a)(r,[{key:"render",value:function(){var e=this.props.userData,t=e.listProducer,r=t.filter((function(e){return"audio"===e.producerType})),n=t.filter((function(e){return"audio"!==e.producerType}));return Object(j.jsx)(nt.a,{className:"col-user-component",span:n.length<=1?12:24,children:Object(j.jsxs)("div",{className:"wrapper",children:[Object(j.jsxs)("div",{className:"user-name",style:e.userId===window.roomClient.localUser.id?{color:"orange"}:{},children:[e.username,r&&r.length>0&&e.userId!==window.roomClient.localUser.id?Object(j.jsx)(dt,{producer:r[0]}):null]}),Object(j.jsx)(rt.a,{className:"row-wrapper-video",children:n.length>0?n.map((function(e,t){return Object(j.jsx)(nt.a,{className:"col-wrapper-video",span:n.length<=1?24:12,children:Object(j.jsx)(ut,{producer:e},t)})})):Object(j.jsx)(nt.a,{span:24,className:"col-wrapper-video ",children:Object(j.jsx)("div",{className:"wrapper-video video-empty",children:"Kh\xf4ng c\xf3 video"})})})]})})}}]),r}(p.PureComponent),pt=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={},e}return Object(u.a)(r,[{key:"render",value:function(){var e=this.props.listUser;return e.sort((function(e,t){return t.listProducer.filter((function(e){return"video"===e.producerType})).length-e.listProducer.filter((function(e){return"video"===e.producerType})).length})),Object(j.jsx)(rt.a,{className:"row-list-user",children:e.map((function(e,t){return Object(j.jsx)(lt,{userData:e},t)}))})}}]),r}(p.Component),ft=Object(m.b)((function(e){return{listUser:e.listUser,listSrcVideo:e.listSrcVideo,consumers:e.consumers}}),{})(pt),mt=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).onSwitchMode=function(){e.props.setSiderActive("none")},e}return Object(u.a)(r,[{key:"render",value:function(){return Object(j.jsxs)("div",{className:"list-user",children:[Object(j.jsxs)("div",{className:"header",children:[Object(j.jsx)("div",{className:"header-title",children:"M\u1ecdi ng\u01b0\u1eddi"}),Object(j.jsx)("div",{className:"header-btn",children:Object(j.jsx)("button",{onClick:this.onSwitchMode,children:Object(j.jsx)("i",{className:"fal fa-times"})})})]}),Object(j.jsx)("div",{className:"wrapper-list-user-camera",children:Object(j.jsx)(ft,{})})]})}}]),r}(p.Component),ht=Object(m.b)((function(e){return{listSrcVideo:e.listSrcVideo,consumers:e.consumers}}),(function(e){return{setSiderActive:function(t){return e(G(t))}}}))(mt),vt=r(156),bt=r(374),jt=r(381),Ot=me.a.Footer,xt=me.a.Content,gt=me.a.Header,wt=bt.a.Search,yt=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).messagebox=void 0,e.shouldComponentUpdate=function(t){return t.messageState.length!==e.props.messageState.length},e.sendMessage=function(){var t=Object(s.a)(c.a.mark((function t(r){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.post("/call/sendMessage",{roomname:window.roomClient.roomname,message:r,userId:window.roomClient.localUser.id});case 2:t.sent,e.props.getMessage(),e.messagebox.setState({value:""});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Object(u.a)(r,[{key:"render",value:function(){for(var e=this,t=this.props.messageState,r=[],n=0;n<t.length;n++){var o=new vt.Message({id:t[n].id===window.roomClient.localUser.id?0:1,senderName:t[n].name,message:t[n].message});r.push(o)}return Object(j.jsx)("div",{className:"home-sider-chat",children:Object(j.jsxs)(me.a,{style:{width:"100%",height:"100%",borderRadius:5,background:"#fff"},children:[Object(j.jsxs)(gt,{style:{height:40,display:"flex",alignItems:"center",justifyContent:"space-between",color:"#fff",fontSize:"14px",padding:"0 10px",background:"#333"},children:[Object(j.jsxs)("b",{style:{marginLeft:10,fontSize:"18px"},children:[" ",Ne.roomName]}),Object(j.jsx)(tt.a,{style:{color:"tomato",fontSize:20,display:"flex",alignItems:"center",justifyContent:"center",padding:0},type:"link",onClick:function(){return e.props.setSiderActive("none")},children:Object(j.jsx)("i",{className:"fal fa-times"})})]}),Object(j.jsx)(xt,{children:Object(j.jsx)(vt.ChatFeed,{messages:r,hasInputField:!1,showSenderName:!0,bubblesCentered:!1,bubbleStyles:{text:{fontSize:13,color:"#050505"},chatbubble:{borderRadius:18,padding:"7px 12px",color:"#000",marginTop:0,marginLeft:5,marginRight:5,backgroundColor:"#e4e6eb",maxWidth:"80%"}}})}),Object(j.jsx)(Ot,{style:{padding:5,borderBottomRightRadius:5,borderBottomLeftRadius:5,background:"#fff"},children:Object(j.jsx)(wt,{ref:function(t){e.messagebox=t},placeholder:"",enterButton:Object(j.jsx)(jt.a,{}),size:"middle",onSearch:this.sendMessage})})]})})}}]),r}(p.Component),kt=Object(m.b)((function(e){return{messageState:e.messageState}}),(function(e){return{getMessage:function(){return e(B())},setSiderActive:function(t){return e(G(t))}}}))(yt),St=me.a.Header,Ct=me.a.Content,It=me.a.Footer,Rt=me.a.Sider,Tt=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={loading:!0,siderFull:!1},e.componentDidMount=function(){if(Ne)try{new Ze(Ne.roomName,Ne.roomKey,Ne.username,function(){var t=Object(s.a)(c.a.mark((function t(r){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(r),t.next=3,r.init();case 3:return t.next=5,r.initSocketEvent();case 5:return window.roomClient=r,e.props.getMessage(),t.next=9,e.setState({loading:!1});case 9:return t.next=11,e.props.getUserInRoom();case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(t){console.log(t)}else e.setState({loading:!0})},e}return Object(u.a)(r,[{key:"render",value:function(){var e=this,t=this.state,r=t.loading,n=t.siderFull,o=this.props.siderActive;return r?Object(j.jsx)("div",{style:{width:"100%",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(j.jsx)(fe.a,{size:"large",tip:"Loading..."})}):Object(j.jsxs)(me.a,{id:"home-page",children:[Object(j.jsx)(xe.a,{onResize:function(t){t.width<769?e.setState({siderFull:!0}):e.setState({siderFull:!1})}}),Object(j.jsx)(St,{style:{display:"none"},id:"home-page-header"}),n?Object(j.jsxs)(me.a,{className:"layout-sub-smallview",children:[Object(j.jsx)(St,{className:"header-smallview",children:Object(j.jsx)(ft,{})}),Object(j.jsxs)(me.a,{style:{background:"transparent"},children:[Object(j.jsx)(Ct,{id:"home-page-content-smallview",children:Object(j.jsx)(it,{})}),Object(j.jsx)(Rt,{width:"chat"===o?360:0,id:"home-page-chat-sider",children:Object(j.jsx)(kt,{})})]}),Object(j.jsx)(ct,{})]}):Object(j.jsxs)(me.a,{className:"layout-sub",children:[Object(j.jsx)(Ct,{id:"home-page-content",children:Object(j.jsx)(it,{})}),Object(j.jsx)(Rt,{width:"chat"===o?360:0,id:"home-page-chat-sider",children:Object(j.jsx)(kt,{})}),Object(j.jsx)(Rt,{width:"users"===o?360:0,id:"home-page-users",children:Object(j.jsx)(ht,{})}),Object(j.jsx)(ct,{})]}),Object(j.jsx)(It,{id:"home-page-footer",children:Object(j.jsx)(_e,{})})]})}}]),r}(p.Component),Nt=Object(m.b)((function(e){return{localStreams:e.localStreams,siderActive:e.siderActive}}),(function(e){return{getUserInRoom:function(){return e(re())},getMessage:function(){return e(B())}}}))(Tt),Ut=r(382),Et=r(211),Mt=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={roomName:"",roomKey:"",username:""},e.componentDidMount=function(){var t=new URL(window.location.href).searchParams.get("option");if(t){var r=decodeURIComponent(window.atob(t)),n=JSON.parse(r);Ne.roomName=n.roomName,Ne.roomKey=n.roomKey,Ne.username=n.username,Ne.sid=n.sid,e.setState({roomName:n.roomName,roomKey:n.roomKey?n.roomKey:"",username:n.username})}else e.setState({loading:!0})},e.onSubmit=function(){Ne.username&&""!==Ne.username.trim()?de.dispatch(se("home")):Ie.b.info("Vui l\xf2ng nh\u1eadp t\xean hi\u1ec3n th\u1ecb!")},e}return Object(u.a)(r,[{key:"render",value:function(){var e=this;return Object(j.jsx)("div",{className:"login-page",children:Object(j.jsxs)("div",{className:"login-wrapper",children:[Object(j.jsx)("div",{style:{textAlign:"center",color:"orangered",fontSize:22,fontWeight:600},children:"VRPACS"}),Object(j.jsx)("div",{style:{textAlign:"center",color:"royalblue",fontSize:16,fontWeight:600},children:"Video Conference"}),Object(j.jsx)("div",{className:"label",children:"T\xean ph\xf2ng"}),Object(j.jsx)(bt.a,{value:this.state.roomName,onChange:function(t){Ne.roomName=t.target.value,e.setState({roomName:Ne.roomName})}}),Object(j.jsx)("div",{className:"label",children:"M\xe3 ph\xf2ng"}),Object(j.jsx)(bt.a.Password,{value:this.state.roomKey,onChange:function(t){Ne.roomKey=t.target.value,e.setState({roomKey:Ne.roomKey})},iconRender:function(e){return e?Object(j.jsx)(Ut.a,{}):Object(j.jsx)(Et.a,{})}}),Object(j.jsx)("div",{className:"label",children:"T\xean hi\u1ec3n th\u1ecb"}),Object(j.jsx)(bt.a,{value:this.state.username,onChange:function(t){Ne.username=t.target.value,e.setState({username:Ne.username})}}),Object(j.jsx)(tt.a,{type:"primary",block:!0,style:{marginTop:20,marginBottom:10},onClick:this.onSubmit,children:"V\xe0o ph\xf2ng"})]})})}}]),r}(p.Component),Pt=Object(m.b)((function(e){return{}}),{})(Mt),Dt=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={},e}return Object(u.a)(r,[{key:"render",value:function(){return"home"===this.props.pageReducer?Object(j.jsx)(Nt,{}):Object(j.jsx)(Pt,{})}}]),r}(p.Component),At=Object(m.b)((function(e){return{pageReducer:e.pageReducer}}),{})(Dt),Vt=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).setGlobalWindowVariable=function(){window.React=f.a,window.ReactDOM=o.a,window.MediaRecorder=window.MediaRecorder,window.RecordRTC=window.RecordRTC,window.config=window.config},n.getConfig=function(){window.config;var e=null,t=localStorage.getItem("serverConfig");t&&(e=JSON.parse(t)),e&&("http:"===window.location.protocol?(k.scuServerUrl=e.HTTP_SCU_SERVER,k.risServerUrl=e.HTTP_RIS_SERVER,k.socketServerUrl=e.HTTP_SOCKET_SERVER):(k.scuServerUrl=e.HTTPS_SCU_SERVER,k.risServerUrl=e.HTTPS_RIS_SERVER,k.socketServerUrl=e.HTTPS_SOCKET_SERVER))},n.setupDevicesDefault=Object(s.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe();case 2:console.log(12312),n.setState({loadDevices:!1});case 4:case"end":return e.stop()}}),e)}))),n.setupDevicesDefault(),n.setGlobalWindowVariable(),n.getConfig(),function(e){var t=C.a.create({timeout:le,baseURL:k.risServerUrl}),r=C.a.create({timeout:le,baseURL:k.socketServerUrl}),n=C.a.create({timeout:le,baseURL:k.scuServerUrl}),o=function(e){var t=localStorage.getItem("token")?localStorage.getItem("token"):"";return t&&(e.headers.Authorization="Bearer ".concat(t)),e},a=function(e){return null===e||void 0===e?void 0:e.data},c=function(e){return de.dispatch(b({show:!0,error:"From: ".concat(e.config.url,"\n")+e})),Promise.reject(e)};t.interceptors.request.use(o),t.interceptors.response.use(a,c),r.interceptors.request.use((function(e){return e})),r.interceptors.response.use(a,c),n.interceptors.request.use(o),n.interceptors.response.use(a,c),t,x=r,g=n}(),n.state={loadDevices:!0,page:"login"},n}return Object(u.a)(r,[{key:"render",value:function(){var e=this.state,t=e.loadDevices;e.page;return t?Object(j.jsx)("div",{style:{width:"100%",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(j.jsx)(fe.a,{size:"large",tip:"Loading devices"})}):Object(j.jsxs)(m.a,{store:de,children:[Object(j.jsx)(y,{}),Object(j.jsx)(At,{})]})}}]),r}(p.Component);o.a.render(Object(j.jsx)(Vt,{}),document.getElementById("root"))}},[[369,1,2]]]);
//# sourceMappingURL=main.eb6f1232.chunk.js.map