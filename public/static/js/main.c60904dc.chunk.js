(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{150:function(e,t,n){},246:function(e,t,n){},276:function(e,t,n){},277:function(e,t,n){},282:function(e,t,n){},362:function(e,t,n){},363:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(0),o=n(24),i=n.n(o),c=n(7),s=n(8),u=n(9),l=n(10),d=n(114),p=n.n(d),m=n(374),h=function(e,t){m.a[e]({message:"Th\xf4ng b\xe1o!",description:t,placement:"bottomRight"})},f=function e(t){var n=this;Object(c.a)(this,e),this.request=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(r,a){n.socket.emit(e,t,(function(e){0===e.status?(h("error",e.message),a(e.data)):r(e.data)}))}))},this.socket=p.a.connect(t)},v=(n(241),n(58)),b="SET_LARGE_VIDEO",j=function(e){return{type:b,payload:e}},O="SET_ROOMCREATE",x=function(e){return{type:O,payload:e}},g="SET_STREAM",k={local:[],remote:[]},y=function(e){return{type:g,payload:e}},w="SET_USERONROOM",S=[],C=function(e){return{type:w,payload:e}},R=n(4),E="SET_VIEW_ONE_CAMERA",T={viewOneCamera:!0},M=function(){return{type:E}},I="SET_REMOTE_STREAM",N=new Map,_=function(e){return{type:I,payload:e}},P="SET_MODAL",V={visible:!1,header:"",render:null},A=function(e){return{type:P,payload:e}},D="SET_MESSAGE",L=[],q=function(e){return{type:D,payload:e}},z="SET_REMOTE_ELEMENT",U=[],F=function(e){return{type:z,payload:e}},B="SET_LOCAL_ELEMENT",W={videos:[],audio:[],screenCast:[]},H=function(e){return{type:B,payload:e}},G=Object(v.c)({streamRemoteState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case I:return e=t.payload;default:return e}},streamState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case g:return e=t.payload;default:return e}},largeVideoState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:return e=t.payload;default:return e}},userOnRoomState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w:return e=t.payload;default:return e}},roomCreateState:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return e=t.payload;default:return e}},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E:return e.viewOneCamera=!e.viewOneCamera,Object(R.a)({},e);default:return e}},modalState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return e=t.payload;default:return e}},messageState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D:return e=t.payload;default:return e}},remoteElementState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case z:return e=t.payload;default:return e}},localElementState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case B:return e=t.payload;default:return e}}}),K=[n(167).a],J=Object(v.d)(G,v.a.apply(void 0,K)),Y=n(22),Q=n(5),X=n.n(Q),Z=n(11),$=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).componentDidMount=function(){var t;e.videoRef.srcObject=null===(t=e.props)||void 0===t?void 0:t.srcObject},e.componentDidUpdate=function(t){var n;t!==e.props&&(e.videoRef.srcObject=null===(n=e.props)||void 0===n?void 0:n.srcObject)},e.onClick=function(){e.props.onClick(e.videoRef)},e}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsx)("video",{id:"video",autoPlay:!0,ref:function(t){e.videoRef=t},width:"100%",height:100,style:{background:"black",paddingTop:5},onClick:this.onClick})}}]),n}(a.PureComponent),ee=(a.PureComponent,n(42)),te=n(52),ne=n.n(te),re=(new Map,n(246),["#f56a00","#7265e6","#ffbf00","#00a2ae,#885569","#7265e6","#885569","#00a2ae,#885569","#885569"]),ae=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){var e,t,n=r.props.item;r.audioRef.srcObject=null===n||void 0===n||null===(e=n.audio)||void 0===e?void 0:e.stream,r.videoRef.srcObject=null===n||void 0===n||null===(t=n.video)||void 0===t?void 0:t.stream,r.videoRef.srcObject?r.setState({hasVideo:!0}):r.setState({hasVideo:!1})},r.componentDidUpdate=function(e){if(r.props.item!==e.item){var t,n,a=r.props.item;r.audioRef.srcObject=null===a||void 0===a||null===(t=a.audio)||void 0===t?void 0:t.stream,r.videoRef.srcObject=null===a||void 0===a||null===(n=a.video)||void 0===n?void 0:n.stream,r.videoRef.srcObject?r.setState({hasVideo:!0}):r.setState({hasVideo:!1})}},r.mute=function(e){e.preventDefault();var t=r.state.mute;r.audioRef.muted=!t,r.setState({mute:!t})},r.setLargeVideo=function(e){r.props.onHandleSetLargeVideos(),J.dispatch(j({stream:r.videoRef.srcObject}))},r.state={mute:!1,hasVideo:!1},r}return Object(s.a)(n,[{key:"render",value:function(){var e,t,n=this;return Object(r.jsxs)("div",{id:this.props.item.peerId,onClick:this.setLargeVideo,style:{border:this.props.item.active?"2px solid red":"none",position:"relative",width:"100%",height:"auto",display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(r.jsx)("span",{style:{color:"#ddd",fontWeight:"bold",position:"absolute",maxWidth:"80%",bottom:5},children:null===(e=this.props.item)||void 0===e?void 0:e.peerName}),this.state.mute?Object(r.jsx)(ee.a,{onClick:this.mute,type:"link",shape:"circle",danger:!0,style:{position:"absolute",top:5,left:5,zIndex:10},icon:Object(r.jsx)("i",{className:"material-icons",children:"volume_off"})}):Object(r.jsx)(ee.a,{onClick:this.mute,type:"link",shape:"circle",danger:!0,style:{position:"absolute",top:5,left:5,zIndex:10},icon:Object(r.jsx)("i",{className:"material-icons",children:"volume_up"})}),this.state.hasVideo?null:Object(r.jsx)("div",{id:"placeHodler",style:{color:"#ddd",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",borderRadius:"50%",width:50,height:50},children:Object(r.jsx)(ne.a,{style:{backgroundColor:"".concat(re[Math.floor(10*Math.random())]),verticalAlign:"middle"},size:"large",children:null===(t=this.props.item)||void 0===t?void 0:t.peerName})}),Object(r.jsx)("video",{ref:function(e){n.videoRef=e},id:"video",autoPlay:!0,width:"100%",height:100,style:{background:"black",border:"2px solid #224567"}}),Object(r.jsx)("audio",{ref:function(e){n.audioRef=e},id:"audio",autoPlay:!0})]})}}]),n}(a.Component);Object(Y.b)((function(e){return{streamRemoteState:e.streamRemoteState,remoteElementState:e.remoteElementState}}),null)(ae);var oe=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).componentDidMount=function(){var t;e.audioRef.srcObject=null===(t=e.props)||void 0===t?void 0:t.srcObject},e.componentDidUpdate=function(t){var n;t!==e.props&&(e.audioRef.srcObject=null===(n=e.props)||void 0===n?void 0:n.srcObject)},e}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsx)("audio",{style:{width:"100%",height:"80px",display:"none"},ref:function(t){e.audioRef=t},id:"audio",autoPlay:!0})}}]),n}(a.PureComponent),ie=["#f56a00","#7265e6","#ffbf00","#00a2ae,#885569","#7265e6","#885569","#00a2ae,#885569","#885569"],ce=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).onVideoClick=function(t){e.props.onHandleSetLargeVideos(),J.dispatch(j({stream:t.srcObject}))},e}return Object(s.a)(n,[{key:"render",value:function(){var e,t,n,a,o=this;return Object(r.jsxs)("div",{style:{width:"100%",height:"auto",border:"2px solid #ff5722",marginBottom:10,borderRadius:2,position:"relative"},children:[Object(r.jsx)("span",{style:{color:"#00bcd4",textShadow:"0 0 black",fontWeight:"bold",position:"absolute",maxWidth:"80%",bottom:5},children:null===(e=this.props.item)||void 0===e?void 0:e.peerName}),0===this.props.item.video.length?Object(r.jsx)("div",{id:"placeHodler",style:{color:"#ddd",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",borderRadius:"50%",width:50,height:50},children:Object(r.jsx)(ne.a,{style:{backgroundColor:"".concat(ie[Math.floor(10*Math.random())]),verticalAlign:"middle"},size:"large",children:null===(t=this.props.item)||void 0===t?void 0:t.peerName})}):null,this.props.item.video.map((function(e,t){return Object(r.jsx)($,{srcObject:e.stream,onClick:o.onVideoClick},t)})),Object(r.jsx)(oe,{srcObject:null===(n=this.props.item)||void 0===n||null===(a=n.audio)||void 0===a?void 0:a.stream})]})}}]),n}(a.Component),se=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).onHandleSetLargeVideo=function(e,t){r.setActive(t)},r.setActive=function(e){for(var t=Object(R.a)({},r.props.streamState),n=t.local,a=0;a<n.length;a++){n[a].active=!1}for(var o=0;o<r.props.userOnRoomState.length;o++){var i=r.props.userOnRoomState[o];i.active=o===e}r.props.setUserOnRoom(r.props.userOnRoomState),r.props.setStream(Object(R.a)({},t))},r.state={mute:!1},r.audioRef=null,r}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsx)("div",{style:{width:"100%",height:"auto",overflow:"auto",padding:1},children:this.props.remoteElementState.map((function(t,n){return Object(r.jsx)(ce,{item:t,onHandleSetLargeVideos:function(){return e.onHandleSetLargeVideo(t,n)}},n)}))})}}]),n}(a.Component);var ue=Object(Y.b)((function(e){return{streamState:e.streamState,userOnRoomState:e.userOnRoomState,remoteElementState:e.remoteElementState}}),(function(e){return{setLargeVideo:function(t){return e(j(t))},setStream:function(t){return e(y(t))},setUserOnRoom:function(t){return e(C(t))}}}))(se),le=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).onVideoClick=function(e){J.dispatch(j({stream:e.srcObject}))},e}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsxs)("div",{style:{width:"100%",height:"auto",overflow:"auto"},children:[this.props.localElementState.videos.map((function(t,n){var a;return Object(r.jsxs)("div",{style:{position:"relative",width:"100%",height:"auto",display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(r.jsxs)("span",{style:{color:"#ddd",textShadow:"1px 1px black",fontWeight:"bold",position:"absolute",maxWidth:"80%",bottom:5},children:[null===(a=window.roomClient)||void 0===a?void 0:a.username," (Me)"]}),Object(r.jsx)($,{srcObject:null===t||void 0===t?void 0:t.stream,onClick:e.onVideoClick})]},n)})),this.props.localElementState.screenCast.map((function(t,n){var a;return Object(r.jsxs)("div",{style:{position:"relative",width:"100%",height:"auto",display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(r.jsxs)("span",{style:{color:"#ddd",textShadow:"1px 1px black",fontWeight:"bold",position:"absolute",maxWidth:"80%",bottom:5},children:[null===(a=window.roomClient)||void 0===a?void 0:a.username," (Me)"]}),Object(r.jsx)($,{srcObject:null===t||void 0===t?void 0:t.stream,onClick:e.onVideoClick})]},n)}))]})}}]),n}(a.Component);var de=Object(Y.b)((function(e){return{localElementState:e.localElementState}}),(function(e){return{setLargeVideo:function(t){return e(j(t))}}}))(le),pe=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return Object(r.jsx)("div",{style:{width:"100%",height:"100%"},children:Object(r.jsx)(ue,{})})}}]),n}(a.Component);var me=Object(Y.b)((function(e){return{streamState:e.streamState}}),null)(pe),he=n(169),fe=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).state={},r.count=0,r}return Object(s.a)(n,[{key:"render",value:function(){return Object(r.jsx)(he.a,{seconds:0,minutes:0,hours:0,render:function(e){var t=e.formatted;e.hours,e.minutes,e.seconds;return Object(r.jsx)("div",{style:{position:"absolute",zIndex:2,background:"#fff",fontWeight:600,top:5,right:5},children:Object(r.jsxs)("p",{style:{margin:4,display:"flex",alignItems:"center",fontSize:12},children:[Object(r.jsx)("i",{style:{fontSize:17},className:"material-icons",children:"alarm"}),t]})})}})}}]),n}(a.Component),ve=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).componentDidMount=function(){var t;e.videoRef.srcObject=null===(t=e.props.largeVideoState)||void 0===t?void 0:t.stream},e.componentDidUpdate=function(t){var n,r;(console.log(null===(n=e.props.largeVideoState)||void 0===n?void 0:n.stream),t.largeVideoState!==e.props.largeVideoState)&&(e.videoRef.srcObject=null===(r=e.props.largeVideoState)||void 0===r?void 0:r.stream)},e}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%",background:"black"},children:[Object(r.jsx)(fe,{}),Object(r.jsx)("video",{autoPlay:!0,ref:function(t){e.videoRef=t},style:{position:"relative",width:"100%",height:"100%",background:"black"}})]})}}]),n}(a.Component);var be=Object(Y.b)((function(e){return{largeVideoState:e.largeVideoState}}),null)(ve),je=(n(150),n(13)),Oe=n(170),xe=n(375),ge="SOCKET_CHANGE_ROOM_PASSWORD",ke="SOCKET_CREATE_ROOM",ye="SOCKET_GET_ROOM_INFO",we="disconnect",Se="SOCKET_USER_LEFT_ROOM",Ce="SOCKET_USER_JOIN_ROOM",Re="INCOMMING_MESSAGE",Ee="SOCKET_EXIT_ROOM",Te="SOCKET_SEND_MESSAGE",Me="SOCKET_GET_MESSAGE_IN_ROOM",Ie="CHECK_ROOM_ALREADY",Ne="CREATE_RTC_TRANSPORT",_e="CONNECT_RTC_TRANSPORT",Pe="CREATE_PRODUCE",Ve="CREATE_CONSUME",Ae="GET_ROUTER_CAPABILITIES",De="GET_PRODUCER",Le="NEW_PRODUCER",qe="CLOSE_PRODUCER",ze="CLOSE_CONSUME",Ue={micEnable:!1,cameraEnable:!1,password:void 0},Fe={audio:"audioType",video:"videoType",screen:"screenType"},Be={exitRoom:"exitRoom",openRoom:"openRoom",startVideo:"startVideo",stopVideo:"stopVideo",startAudio:"startAudio",stopAudio:"stopAudio",startScreen:"startScreen",stopScreen:"stopScreen"},We=function(){function e(t,n,r,a,o,i){var s=this;Object(c.a)(this,e),this.createRoom=function(){var e=Object(Z.a)(X.a.mark((function e(t,n){var r;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.socket.request(ke,{roomName:t,password:n});case 2:r=e.sent,console.log(r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.join=function(){var e=Object(Z.a)(X.a.mark((function e(t,n,r){var a,o,i,c,u,l;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.socket.request(Ce,{username:t,roomName:n,password:r});case 2:return e.next=4,s.socket.request(Ae);case 4:return a=e.sent,console.log(a),e.next=8,s.loadDevice(a);case 8:return o=e.sent,s.device=o,e.next=12,s.initTransports(o);case 12:return e.next=14,s.socket.request(ye);case 14:for(i=e.sent,c=new Map,console.log("myRoom",i),u=0;u<i.length;u++)i[u].socketId!==s.socket.id&&(console.log("vao day"),l=J.getState().streamRemoteState.get(i[u].socketId),c.set(i[u].socketId,{active:!1,audio:null===l||void 0===l?void 0:l.audio,video:null===l||void 0===l?void 0:l.video}));return J.dispatch(_(c)),J.dispatch(C(i.filter((function(e){return e.id!==s.socket.id})))),e.next=22,s.socket.emit(De);case 22:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.loadDevice=function(){var e=Object(Z.a)(X.a.mark((function e(t){var n;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n=new s.mediasoupClient.Device}catch(r){"UnsupportedError"===r.name&&console.error("browser not supported"),console.error(r)}return e.next=3,n.load({routerRtpCapabilities:t});case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.initTransports=function(){var e=Object(Z.a)(X.a.mark((function e(t){var n,r;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.socket.request(Ne,{forceTcp:!1,rtpCapabilities:t.rtpCapabilities});case 2:if(!(n=e.sent).error){e.next=6;break}return console.error(n.error),e.abrupt("return");case 6:return s.producerTransport=t.createSendTransport(n),s.producerTransport.on("connect",function(){var e=Object(Z.a)(X.a.mark((function e(t,r,a){var o;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.dtlsParameters,console.log(o),e.prev=2,e.next=5,s.socket.request(_e,{dtlsParameters:o,transport_id:n.id});case 5:r(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),a(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n,r){return e.apply(this,arguments)}}()),s.producerTransport.on("produce",function(){var e=Object(Z.a)(X.a.mark((function e(t,n,r){var a,o,i,c,u;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.kind,o=t.rtpParameters,e.prev=1,e.next=4,s.socket.request(Pe,{producerTransportId:s.producerTransport.id,kind:a,rtpParameters:o});case 4:i=e.sent,c=i.producer_id,u=i.producer_name,n({id:c,producer_name:u}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),r(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,n,r){return e.apply(this,arguments)}}()),s.producerTransport.on("connectionstatechange",(function(e){switch(e){case"connecting":case"connected":break;case"failed":s.producerTransport.close()}})),e.next=12,s.socket.request(Ne,{forceTcp:!1});case 12:if(!(r=e.sent).error){e.next=16;break}return console.error(r.error),e.abrupt("return");case 16:s.consumerTransport=t.createRecvTransport(r),s.consumerTransport.on("connect",function(){var e=Object(Z.a)(X.a.mark((function e(t,n,r){var a;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.dtlsParameters,e.prev=1,e.next=4,s.socket.request(_e,{transport_id:s.consumerTransport.id,dtlsParameters:a});case 4:n(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),r(r);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}()),s.consumerTransport.on("connectionstatechange",function(){var e=Object(Z.a)(X.a.mark((function e(t){return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="connecting"===e.t0?3:"connected"===e.t0?4:"failed"===e.t0?5:7;break;case 3:case 4:return e.abrupt("break",8);case 5:return s.consumerTransport.close(),e.abrupt("break",8);case 7:return e.abrupt("break",8);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.initSockets=function(){s.socket.on("incomingMessage",(function(e){console.log(e),J.dispatch(q(e))})),s.socket.on("userJoinRoom",function(){var e=Object(Z.a)(X.a.mark((function e(t){var n,r,a,o,i;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,t.id,m.a.info({message:"Th\xf4ng b\xe1o",description:n+" \u0111\xe3 tham gia v\xe0o cu\u1ed9c h\u1ecdp",placement:"bottomRight"}),e.next=4,s.socket.request("getMyRoomInfo");case 4:for(r=e.sent,a=new Map,o=0;o<r.length;o++)r[o].id!==s.socket.id&&(i=J.getState().streamRemoteState.get(r[o].id),a.set(r[o].id,{active:!1,audio:null===i||void 0===i?void 0:i.audio,video:null===i||void 0===i?void 0:i.video}));J.dispatch(C(r.filter((function(e){return e.id!==s.socket.id})))),J.dispatch(_(a));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s.socket.on("userLeftRoom",function(){var e=Object(Z.a)(X.a.mark((function e(t){var n,r,a,o,i;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,t.id,m.a.warning({message:"Th\xf4ng b\xe1o",description:n+" \u0111\xe3 r\u1eddi kh\u1ecfi cu\u1ed9c h\u1ecdp",placement:"bottomRight"}),e.next=4,s.socket.request("getMyRoomInfo");case 4:for(r=e.sent,a=new Map,o=0;o<r.length;o++)r[o].id!==s.socket.id&&(i=J.getState().streamRemoteState.get(r[o].id),a.set(r[o].id,{active:!1,audio:null===i||void 0===i?void 0:i.audio,video:null===i||void 0===i?void 0:i.video}));J.dispatch(C(r.filter((function(e){return e.id!==s.socket.id})))),J.dispatch(_(a));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s.socket.on("consumerClosed",(function(e){var t=e.consumer_id;console.log("closing consumer:",t),s.removeConsumer(t)})),s.socket.on(Le,function(){var e=Object(Z.a)(X.a.mark((function e(t){var n,r,a,o,i;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t),n=0;case 2:if(!(n<t.length)){e.next=9;break}return r=t[n],a=r.producer_id,o=r.peerName,i=r.peerId,e.next=6,s.consume(a,o,i);case 6:n++,e.next=2;break;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s.socket.on("disconnect",(function(){s.exit(!1)}))},this.produce=function(){var e=Object(Z.a)(X.a.mark((function e(t){var n,r,a,o,i,c,u,l,d,p,m=arguments;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=m.length>1&&void 0!==m[1]?m[1]:null,r={},a=!1,o=!1,e.t0=t,e.next=e.t0===Fe.audio?7:e.t0===Fe.video?10:e.t0===Fe.screen?12:15;break;case 7:return r={audio:{deviceId:n},video:!1},a=!0,e.abrupt("break",17);case 10:return r={audio:!1,video:{width:{min:640,ideal:1920},height:{min:400,ideal:1080},deviceId:n}},e.abrupt("break",17);case 12:return r=!1,o=!0,e.abrupt("break",17);case 15:return e.abrupt("return");case 17:if(s.device.canProduce("video")||a){e.next=20;break}return console.error("cannot produce video"),e.abrupt("return");case 20:if(!s.producerLabel.has(t)){e.next=23;break}return console.log("producer already exists for this type "+t),e.abrupt("return");case 23:if(e.prev=23,!o){e.next=30;break}return e.next=27,navigator.mediaDevices.getDisplayMedia();case 27:e.t1=e.sent,e.next=33;break;case 30:return e.next=32,navigator.mediaDevices.getUserMedia(r);case 32:e.t1=e.sent;case 33:return i=e.t1,c=a?i.getAudioTracks()[0]:i.getVideoTracks()[0],u={track:c},a||o||(u.encodings=[{rid:"r0",maxBitrate:1e5,scalabilityMode:"S1T3"},{rid:"r1",maxBitrate:3e5,scalabilityMode:"S1T3"},{rid:"r2",maxBitrate:9e5,scalabilityMode:"S1T3"}],u.codecOptions={videoGoogleStartBitrate:1e3}),e.next=39,s.producerTransport.produce(u);case 39:s.producer=e.sent,s.producers.set(s.producer.id,s.producer),a||(l=Object(R.a)({},J.getState().streamState),d=l.local,p=l.remote,d.push({stream:i,id:s.producer.id,name:s.name,hasVideo:!0}),J.dispatch(y({local:d,remote:p})),J.dispatch(j({stream:i}))),s.producer.on("trackended",(function(){console.log("producer trackend"),s.closeProducer(t)})),s.producer.on("transportclose",(function(){console.log("producer transport close"),s.producers.delete(s.producer.id)})),s.producer.on("close",(function(){console.log("closing producer"),s.producers.delete(s.producer.id)})),s.producerLabel.set(t,s.producer.id),e.t2=t,e.next=e.t2===Fe.audio?49:e.t2===Fe.video?51:e.t2===Fe.screen?53:55;break;case 49:return s.event(Be.startAudio),e.abrupt("break",57);case 51:return s.event(Be.startVideo),e.abrupt("break",57);case 53:return s.event(Be.startScreen),e.abrupt("break",57);case 55:return e.abrupt("return");case 57:e.next=62;break;case 59:e.prev=59,e.t3=e.catch(23),console.log(e.t3);case 62:case"end":return e.stop()}}),e,null,[[23,59]])})));return function(t){return e.apply(this,arguments)}}(),this.consume=function(){var e=Object(Z.a)(X.a.mark((function e(t,n,r){var a;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=s.cloneMap(J.getState().streamRemoteState),s.getConsumeStream(t).then((function(e){var t=e.consumer,n=e.stream,o=e.kind;s.consumers.set(t.id,t);var i=a.get(r);i&&("video"===o?i.video={type:"video",stream:n,id:t.id}:i.audio={type:"audio",stream:n,id:t.id},console.log("123",n),J.dispatch(_(a)),t.on("trackended",(function(){console.log("consumer trackend"),s.removeConsumer(t.id)})),t.on("transportclose",(function(){console.log("consumer transportclose"),s.removeConsumer(t.id)})))}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.getConsumeStream=function(){var e=Object(Z.a)(X.a.mark((function e(t){var n,r,a,o,i,c,u,l,d;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.device.rtpCapabilities,e.next=3,s.socket.request(Ve,{rtpCapabilities:n,consumerTransportId:s.consumerTransport.id,producerId:t});case 3:return r=e.sent,a=r.params,o=a.id,i=a.kind,c=a.rtpParameters,u={},e.next=8,s.consumerTransport.consume({id:o,producerId:t,kind:i,rtpParameters:c,codecOptions:u});case 8:return l=e.sent,console.log(l.track),(d=new MediaStream).addTrack(l.track),e.abrupt("return",{consumer:l,stream:d,kind:i});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.closeProducer=function(e){if(s.producerLabel.has(e)){var t=s.producerLabel.get(e);if(s.socket.emit("producerClosed",{producer_id:t}),s.producers.get(t).close(),s.producers.delete(t),s.producerLabel.delete(e),e!==Fe.audio){var n=J.getState().streamState,r=n.remote.filter((function(e){return e.id!==t})),a=n.local.filter((function(e){return e.id!==t}));J.dispatch(y({local:a,remote:r}))}switch(e){case Fe.audio:s.event(Be.stopAudio);break;case Fe.video:s.event(Be.stopVideo);break;case Fe.screen:s.event(Be.stopScreen);break;default:return}}else console.log("there is no producer for this type "+e)},this.resumeProducer=function(e){if(s.producerLabel.has(e)){var t=s.producerLabel.get(e);s.producers.get(t).resume()}else console.log("there is no producer for this type "+e)},this.removeConsumer=function(e){var t=s.cloneMap(J.getState().streamRemoteState);t.forEach((function(t){var n=t.audio,r=t.video;n&&n.id===e&&(t.audio=null),r&&r.id===e&&(t.video=null)})),J.dispatch(_(t)),s.consumers.delete(e)},this.getAllRemoteVideo=function(){},this.cloneMap=function(e){var t,n=new Map,r=Object(Oe.a)(e);try{for(r.s();!(t=r.n()).done;){var a=Object(je.a)(t.value,2),o=a[0],i=a[1];n.set(o,i)}}catch(c){r.e(c)}finally{r.f()}return n},this.getAllChat=Object(Z.a)(X.a.mark((function e(){var t;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.socket.request("getAllChat");case 2:t=e.sent,console.log(t),J.dispatch(q(t));case 5:case"end":return e.stop()}}),e)}))),this.roomInfo=Object(Z.a)(X.a.mark((function e(){var t;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.socket.request("roomInfo");case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),this.changePassword=Object(Z.a)(X.a.mark((function e(){var t;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.socket.request("changePass",Ue.password);case 2:t=e.sent,xe.b.info(t);case 4:case"end":return e.stop()}}),e)}))),this.event=function(e){console.log(e),s.eventListeners.has(e)&&s.eventListeners.get(e).forEach((function(e){return e()}))},this.on=function(e,t){s.eventListeners.get(e).push(t)},this.isOpen=function(){return s._isOpen},this.name=a,this.mediasoupClient=t,this.socket=n,this.producerTransport=null,this.consumerTransport=null,this.device=null,this.room_id=r,this.consumers=new Map,this.producers=new Map,this.producerLabel=new Map,this._isOpen=!1,this.eventListeners=new Map,Object.keys(Be).forEach((function(e){s.eventListeners.set(e,[])})),this.password=o,this.createRoom(r,o).then(Object(Z.a)(X.a.mark((function e(){return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.join(a,r,o);case 2:return console.log("join"),e.next=5,s.initSockets();case 5:s._isOpen=!0,console.log("successCallback"),i();case 8:case"end":return e.stop()}}),e)}))))}return Object(s.a)(e,[{key:"pauseProducer",value:function(e){if(this.producerLabel.has(e)){var t=this.producerLabel.get(e);this.producers.get(t).pause()}else console.log("there is no producer for this type "+e)}},{key:"exit",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=function(){e._isOpen=!1,e.consumerTransport.close(),e.producerTransport.close(),e.socket.off("disconnect"),e.socket.off("newProducers"),e.socket.off("consumerClosed"),e.socket.off("userJoinRoom"),e.socket.off("userLeftRoom")};t?n():this.socket.request("exitRoom").then((function(e){return console.log(e)})).catch((function(e){return console.warn(e)})).finally((function(){n()})),J.dispatch(y({local:[],remote:[]})),this.event(Be.exitRoom)}}],[{key:"mediaType",get:function(){return Fe}},{key:"EVENTS",get:function(){return Be}}]),e}(),He=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=Object(Z.a)(X.a.mark((function e(){var t,n,a,o;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.navigator.mediaDevices.enumerateDevices();case 2:for(t=e.sent,n=[],a=0;a<t.length;a++)"videoinput"===(o=t[a]).kind&&n.push({deviceInfo:o,active:!1});r.setState({video:n});case 6:case"end":return e.stop()}}),e)}))),r.onActiveOptionCamera=function(){var e=Object(Z.a)(X.a.mark((function e(t,n){var a,o,i,c,s;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=r.state.video,o=0;case 2:if(!(o<a.length)){e.next=15;break}if(i=a[o],o!==n){e.next=11;break}return i.active=!0,e.next=8,null===(c=window.roomClient)||void 0===c?void 0:c.closeProducer(We.mediaType.video);case 8:null===(s=window.roomClient)||void 0===s||s.produce(We.mediaType.video,i.deviceInfo.deviceId),e.next=12;break;case 11:i.active=!1;case 12:o++,e.next=2;break;case 15:r.setState({video:a});case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.state={video:[]},r}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsxs)("div",{className:"micOption",children:[Object(r.jsxs)("div",{className:"row",children:[Object(r.jsx)("i",{className:"material-icons",children:" videocam"}),Object(r.jsx)("h2",{children:"Videos"})]}),this.state.video.map((function(t,n){return Object(r.jsxs)("div",{onClick:function(){return e.onActiveOptionCamera(t,n)},children:[" ",Object(r.jsxs)("div",{className:"row padding",children:[t.active?Object(r.jsx)("i",{className:"material-icons",children:" check"}):Object(r.jsx)("i",{className:"material-icons",children:" videocam"}),Object(r.jsx)("span",{children:t.deviceInfo.label})]})]},"camera"+n)}))]},"camera")}}]),n}(a.Component),Ge=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return Object(r.jsx)("div",{style:{width:"100%",height:"100%"},children:Object(r.jsx)(de,{})})}}]),n}(a.Component);var Ke=Object(Y.b)((function(e){return{streamState:e.streamState}}),null)(Ge),Je=n(372),Ye=(n(276),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).openFullscreen=function(){var e=document.documentElement;r.state.fullscreen?document.exitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),r.setState({fullscreen:!r.state.fullscreen})},r.state={fullscreen:!1},r}return Object(s.a)(n,[{key:"render",value:function(){return Object(r.jsxs)("div",{className:"menuOption",children:[Object(r.jsxs)("div",{onClick:function(){},children:[" ",Object(r.jsxs)("div",{className:"row padding",children:[Object(r.jsx)("i",{className:"material-icons",children:" high_quality"}),Object(r.jsx)("span",{children:"Ch\u1ea5t l\u01b0\u1ee3ng"})]})]}),Object(r.jsx)("div",{onClick:this.openFullscreen,children:this.state.fullscreen?Object(r.jsxs)("div",{className:"row padding",children:[Object(r.jsx)("i",{className:"material-icons",children:" fullscreen_exit"}),Object(r.jsx)("span",{children:"Tho\xe1t to\xe0n m\xe0n h\xecnh"})]}):Object(r.jsxs)("div",{className:"row padding",children:[Object(r.jsx)("i",{className:"material-icons",children:" fullscreen"}),Object(r.jsx)("span",{children:"To\xe0n m\xe0n h\xecnh"})]})}),Object(r.jsxs)("div",{onClick:function(){},children:[" ",Object(r.jsxs)("div",{className:"row padding",children:[Object(r.jsx)("i",{className:"material-icons",children:" mic"}),Object(r.jsx)("span",{children:"Ghi \xe2m"})]})]}),Object(r.jsxs)("div",{onClick:function(){},children:[" ",Object(r.jsxs)("div",{className:"row padding",children:[Object(r.jsx)("i",{className:"material-icons",children:" videocam"}),Object(r.jsx)("span",{children:"Quay video"})]})]})]})}}]),n}(a.Component)),Qe=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=Object(Z.a)(X.a.mark((function e(){var t,n,a,o,i;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.navigator.mediaDevices.enumerateDevices();case 2:for(t=e.sent,n=[],a=[],o=0;o<t.length;o++)"audioinput"===(i=t[o]).kind&&n.push({deviceInfo:i,active:"default"===i.deviceId}),"audiooutput"===i.kind&&a.push({deviceInfo:i,active:"default"===i.deviceId});r.setState({mic:n,speaker:a});case 7:case"end":return e.stop()}}),e)}))),r.onActiveOptionMic=function(e,t){for(var n=r.state.mic,a=0;a<n.length;a++){var o=n[a];o.active=a===t}r.setState({mic:n})},r.onActiveOptionCamera=function(e,t){for(var n=r.state.speaker,a=0;a<n.length;a++){var o=n[a];o.active=a===t}r.setState({speaker:n})},r.state={mic:[],speaker:[]},r}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsxs)("div",{className:"micOption",children:[Object(r.jsxs)("div",{className:"row",children:[Object(r.jsx)("i",{className:"material-icons",children:" mic"}),Object(r.jsx)("h2",{children:"Microphones"})]}),this.state.mic.map((function(t,n){return Object(r.jsx)("div",{onClick:function(){return e.onActiveOptionMic(t,n)},className:t.active?"active":"",children:Object(r.jsxs)("div",{className:"row padding",children:[t.active?Object(r.jsx)("i",{className:"material-icons",children:" check"}):Object(r.jsx)("i",{className:"material-icons",children:" mic"}),Object(r.jsx)("span",{children:t.deviceInfo.label})]})},"mic"+n)})),Object(r.jsxs)("div",{className:"row",children:[Object(r.jsx)("i",{className:"material-icons",children:" volume_up"}),Object(r.jsx)("h2",{children:"Speaker"})]}),this.state.speaker.map((function(t,n){return Object(r.jsx)("div",{onClick:function(){return e.onActiveOptionCamera(t,n)},className:t.active?"active":"",children:Object(r.jsxs)("div",{className:"row padding",children:[t.active?Object(r.jsx)("i",{className:"material-icons",children:" check"}):Object(r.jsx)("i",{className:"material-icons",children:" volume_up"}),Object(r.jsx)("span",{children:t.deviceInfo.label})]})},"speaker"+n)}))]},"mic")}}]),n}(a.Component),Xe=(n(277),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).onChangeView=function(){console.log("onChangeView"),r.props.setViewOneCamera()},r.state={openCamera:Ue.cameraEnable,openMic:Ue.micEnable},r}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props.userOnRoomState;return Object(r.jsxs)("div",{className:"footerTool",style:{width:"100%",height:"100%",justifyContent:"center",alignItems:"center",display:"flex",position:"relative"},children:[Object(r.jsxs)("div",{style:{position:"absolute",left:0,display:"flex"},children:[Object(r.jsx)(ee.a,{style:{margin:"0px 5px"},onClick:this.props.onDisplayChat,size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"chat"})}),Object(r.jsx)(ee.a,{style:{margin:"0px 5px"},onClick:this.props.onDisplayRoomInfo,size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"security"})}),Object(r.jsx)(Je.a,{overlay:Object(r.jsx)(Ye,{}),trigger:["click"],children:Object(r.jsx)(ee.a,{style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"menu"})})}),","]}),Object(r.jsx)(ee.a,{onClick:this.props.onStartScreenShare,style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"tv"})}),this.state.openMic?Object(r.jsxs)("div",{style:{position:"relative"},children:[Object(r.jsx)(ee.a,{onClick:function(){e.props.onStopMic(),e.setState({openMic:!1})},style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"mic"})}),Object(r.jsx)(Je.a,{forceRender:!0,trigger:["click"],overlay:Object(r.jsx)(Qe,{}),children:Object(r.jsx)(ee.a,{size:"small",shape:"circle",style:{position:"absolute",bottom:-3,right:-3},icon:Object(r.jsx)("i",{className:"material-icons",children:"expand_more"})},"dasda")})]},"mic"):Object(r.jsx)(ee.a,{onClick:function(){e.props.onOpenMic(),e.setState({openMic:!0})},style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"mic_off"})}),Object(r.jsx)(ee.a,{style:{margin:"0px 5px"},size:"large",type:"primary",shape:"circle",danger:!0,icon:Object(r.jsx)("i",{className:"material-icons",children:"call_end"}),onClick:this.props.onEndCall}),this.state.openCamera?Object(r.jsxs)("div",{style:{position:"relative"},children:[Object(r.jsx)(ee.a,{onClick:function(){e.props.onStopCamera(),e.setState({openCamera:!1})},style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"videocam"})}),Object(r.jsx)(Je.a,{forceRender:!0,trigger:["click"],overlay:Object(r.jsx)(He,{}),children:Object(r.jsx)(ee.a,{size:"small",shape:"circle",style:{position:"absolute",bottom:-3,right:-3},icon:Object(r.jsx)("i",{className:"material-icons",children:"expand_more"})})})]},"camera"):Object(r.jsx)(ee.a,{onClick:function(){e.props.onOpenCamera(),e.setState({openCamera:!0})},style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"videocam_off"})}),Object(r.jsxs)("div",{style:{position:"absolute",right:0,display:"flex"},children:[t.length>1?Object(r.jsx)(ee.a,{style:{margin:"0px 5px"},size:"large",onClick:this.onChangeView,shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"grid_on"})}):null,Object(r.jsx)(ee.a,{onClick:this.props.onShareLink,style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"person_add"})}),Object(r.jsx)(ee.a,{onClick:this.props.onDisplayRemote,style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"swap_horiz"})})]})]})}}]),n}(a.Component));var Ze=Object(Y.b)((function(e){return{streamState:e.streamState,userOnRoomState:e.userOnRoomState}}),(function(e){return{setViewOneCamera:function(){return e(M())}}}))(Xe),$e=n(371),et=n(369),tt=["#f56a00","#7265e6","#ffbf00","#00a2ae,#885569","#7265e6","#885569","#00a2ae,#885569","#885569"],nt=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){var e,t,n=r.props.streamRemoteState.get(r.props.item.id);r.audioRef.srcObject=null===n||void 0===n||null===(e=n.audio)||void 0===e?void 0:e.stream,r.videoRef.srcObject=null===n||void 0===n||null===(t=n.video)||void 0===t?void 0:t.stream,r.videoRef.srcObject?r.setState({hasVideo:!0}):r.setState({hasVideo:!1})},r.componentDidUpdate=function(e){if(r.props.streamRemoteState!==e.streamRemoteState){var t,n,a=r.props.streamRemoteState.get(r.props.item.id);r.audioRef.srcObject=null===a||void 0===a||null===(t=a.audio)||void 0===t?void 0:t.stream,r.videoRef.srcObject=null===a||void 0===a||null===(n=a.video)||void 0===n?void 0:n.stream,r.videoRef.srcObject?r.setState({hasVideo:!0}):r.setState({hasVideo:!1})}},r.mute=function(e){e.preventDefault();var t=r.state.mute;r.audioRef.muted=!t,r.setState({mute:!t})},r.setLargeVideo=function(e){r.props.onHandleSetLargeVideos(),J.dispatch(j({stream:r.videoRef.srcObject})),r.props.setViewOneCamera(!0)},r.state={mute:!1,hasVideo:!1},r.audioRef=null,r.videoRef=null,r}return Object(s.a)(n,[{key:"render",value:function(){var e,t,n,a=this,o=this.props.elementWidth;return Object(r.jsx)("div",{className:"media-element",style:{width:"".concat(o,"%"),height:"".concat(16*o/9,"%")},children:Object(r.jsx)("div",{className:"media-element-container",children:Object(r.jsxs)("div",{id:this.props.item.id,onClick:this.setLargeVideo,style:{border:this.props.item.active?"2px solid red":"none",position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(r.jsx)("span",{style:{color:"#ddd",fontWeight:"bold",position:"absolute",maxWidth:"80%",bottom:5},children:null===(e=this.props.item)||void 0===e?void 0:e.name}),this.state.mute?Object(r.jsx)(ee.a,{onClick:this.mute,type:"link",shape:"circle",danger:!0,style:{position:"absolute",top:5,left:5,zIndex:10},icon:Object(r.jsx)("i",{className:"material-icons",children:"volume_off"})}):Object(r.jsx)(ee.a,{danger:!0,onClick:this.mute,type:"link",shape:"circle",style:{position:"absolute",top:5,left:5,zIndex:10},icon:Object(r.jsx)("i",{className:"material-icons",children:"volume_up"})}),this.state.hasVideo?null:Object(r.jsx)("div",{id:"placeHodler",style:{color:"#ddd",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",borderRadius:"50%",width:200,height:200},children:Object(r.jsx)(ne.a,{style:{backgroundColor:"".concat(tt[Math.floor(10*Math.random())]),verticalAlign:"middle",width:"100%",height:"100%"},size:"large",children:null===(t=this.props.item)||void 0===t||null===(n=t.name.match(/\b([A-Z])/g))||void 0===n?void 0:n.join("")})}),Object(r.jsx)("video",{ref:function(e){a.videoRef=e},id:"video",autoPlay:!0,width:"100%",height:"100%",style:{background:"black",border:"2px solid #224567"}}),Object(r.jsx)("audio",{ref:function(e){a.audioRef=e},id:"audio",autoPlay:!0})]})})})}}]),n}(a.Component);var rt=Object(Y.b)((function(e){return{streamRemoteState:e.streamRemoteState}}),(function(e){return{setViewOneCamera:function(t){return e(M())}}}))(nt),at=(n(282),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){var e=r.props.userOnRoomState;e.length<5?r.setState({widthMediaElement:100/e.length}):r.setState({widthMediaElement:25})},r.componentDidUpdate=function(e){var t=r.props.userOnRoomState;e.userOnRoomState!==t&&(t.length<5?r.setState({widthMediaElement:100/t.length}):r.setState({widthMediaElement:25}),t.length<2&&r.props.setViewOneCamera(!0))},r.onHandleSetLargeVideo=function(e,t){r.setActive(t)},r.setActive=function(e){for(var t=Object(R.a)({},r.props.streamState),n=t.local,a=0;a<n.length;a++){n[a].active=!1}for(var o=Array.from(r.props.userOnRoomState),i=0;i<o.length;i++){var c=o[i];c.active=i===e}r.props.setUserOnRoom(o),r.props.setStream(Object(R.a)({},t))},r.state={widthMediaElement:0},r}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props.userOnRoomState,n=this.state.widthMediaElement;return Object(r.jsx)("div",{className:"multipleMedia__container",children:t.map((function(t,a){return Object(r.jsx)(rt,{item:t,elementWidth:n,onHandleSetLargeVideos:e.onHandleSetLargeVideo},a)}))})}}]),n}(a.Component));var ot=Object(Y.b)((function(e){return{viewOneCamera:e.ui.viewOneCamera,userOnRoomState:e.userOnRoomState,streamState:e.streamState}}),(function(e){return{setViewOneCamera:function(t){return e(M())},setStream:function(t){return e(y(t))},setUserOnRoom:function(t){return e(C(t))}}}))(at),it=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).handleCancel=function(t){e.props.setModal({visible:!1,header:"",render:null})},e.onOk=function(){window.roomClient.changePassword()},e}return Object(s.a)(n,[{key:"render",value:function(){return console.log(this.props.modalState),Object(r.jsx)(et.a,{title:this.props.modalState.header,visible:this.props.modalState.visible,onCancel:this.handleCancel,onOk:this.onOk,closable:!1,children:this.props.modalState.render})}}]),n}(a.Component);var ct=Object(Y.b)((function(e){return{modalState:e.modalState}}),(function(e){return{setModal:function(t){return e(A(t))}}}))(it),st=n(366),ut=n(370),lt=n(376),dt=n(377),pt=n(373),mt=n(367),ht=n(368),ft=$e.a.Footer,vt=$e.a.Content,bt=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).sendMessage=function(e){window.roomClient.sendMessageChat(e.message)},e}return Object(s.a)(n,[{key:"render",value:function(){return Object(r.jsxs)($e.a,{style:{width:350,height:"100%"},children:[Object(r.jsx)(vt,{style:{width:"100%"},children:this.props.messageState.map((function(e,t){return Object(r.jsxs)(st.a,{children:[Object(r.jsx)(mt.a,{span:3,style:{alignItems:"flex-end",display:"flex",padding:5},children:e.id===window.roomClient.socket.id?null:Object(r.jsx)(ne.a,{src:"./icons/avatar.png"})}),Object(r.jsxs)(mt.a,{span:21,children:[e.id===window.roomClient.socket.id?null:Object(r.jsx)(st.a,{style:{width:"100%"},children:Object(r.jsx)("div",{style:{fontSize:11,color:"#90949c"},children:e.name})}),Object(r.jsx)(st.a,{style:{width:"100%"},children:Object(r.jsx)("div",{style:e.id===window.roomClient.socket.id?{marginTop:2,marginBottom:2,marginRight:5,background:"#42a5f5",color:"#fff",borderRadius:"20px 20px 3px 20px",display:"block",maxWidth:"75%",padding:"7px 13px 7px 13px",marginLeft:"auto",fontSize:13}:{marginTop:2,marginBottom:2,background:"#ddd",borderRadius:"20px 20px 20px 3px",display:"block",maxWidth:"75%",padding:"7px 13px 7px 13px",float:"left",fontSize:13,color:"#444950"},children:e.message})})]})]},t)}))}),Object(r.jsx)(ft,{style:{padding:0,margin:10,display:"flex",justifyContent:"center",alignItems:"center"},children:Object(r.jsxs)(ht.a,{layout:"inline",name:"horizontal_login",onFinish:this.sendMessage,children:[Object(r.jsx)(ht.a.Item,{name:"message",children:Object(r.jsx)(ut.a,{placeholder:"Nh\u1eadp tin nh\u1eafn"})}),Object(r.jsx)(ht.a.Item,{children:Object(r.jsx)(ee.a,{style:{justifyContent:"center",alignItems:"center",display:"flex"},type:"primary",htmlType:"submit",icon:Object(r.jsx)("i",{className:"material-icons",children:"send"})})})]})})]})}}]),n}(a.Component);var jt=Object(Y.b)((function(e){return{messageState:e.messageState}}),null)(bt),Ot=($e.a.Header,$e.a.Footer),xt=$e.a.Sider,gt=$e.a.Content,kt="audioType",yt="videoType",wt="screenType",St=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).componentDidMount=function(){Ue.cameraEnable&&a.onOpenCamera(),Ue.micEnable&&a.onOpenMic()},a.onOpenMic=function(){var e;Ue.micEnable=!0,null===(e=window.roomClient)||void 0===e||e.produce(kt,null)},a.onStopMic=function(){var e;Ue.micEnable=!1,null===(e=window.roomClient)||void 0===e||e.closeProducer(kt)},a.onOpenCamera=function(){var e;Ue.cameraEnable=!0,null===(e=window.roomClient)||void 0===e||e.produce(yt,!0)},a.onStopCamera=function(){var e;Ue.cameraEnable=!1,null===(e=window.roomClient)||void 0===e||e.closeProducer(yt)},a.onStartScreenShare=function(){var e;null===(e=window.roomClient)||void 0===e||e.produce(wt)},a.onEndCall=function(){var e;null===(e=window.roomClient)||void 0===e||e.exit(!1),J.dispatch(x(!1))},a.onDisplayChat=function(){var e=document.getElementById("chatElement");"none"===e.style.display?(e.style.display="flex",window.roomClient.getMessageInRoom()):e.style.display="none"},a.onDisplayRemote=function(){var e=document.getElementById("remoteVideos"),t=e.style.display;e.style.display="none"===t?"flex":"none"},a.onDisplayRoomInfo=Object(Z.a)(X.a.mark((function e(){var t;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.roomClient.roomInfo();case 2:t=e.sent,a.props.setModal({visible:!0,header:"Th\xf4ng tin cu\u1ed9c h\u1ecdp",render:Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(st.a,{style:{margin:"5px 0"},children:Object(r.jsx)(ut.a,{addonBefore:Object(r.jsx)(lt.a,{icon:Object(r.jsx)(dt.a,{}),color:"#55acee",children:"T\xean ph\xf2ng:"}),placeholder:"Nh\u1eadp t\xean ph\xf2ng",disabled:!0,value:t.name})}),Object(r.jsx)(st.a,{style:{margin:"5px 0"},children:Object(r.jsx)(ut.a.Password,{onChange:function(e){Ue.password=e.target.value},addonBefore:Object(r.jsx)(lt.a,{icon:Object(r.jsx)(dt.a,{}),color:"#cd201f",children:"M\u1eadt kh\u1ea9u:"}),placeholder:"Nh\u1eadp m\u1eadt kh\u1ea9u",value:t.password})})]})});case 4:case"end":return e.stop()}}),e)}))),a.onShareLink=function(){et.a.info({title:"Li\xean k\u1ebft chia s\u1ebb",content:Object(r.jsx)("div",{children:Object(r.jsx)(ut.a.Search,{id:"copyLink",onSearch:function(e){document.getElementById("copyLink").select(),document.execCommand("copy"),xe.b.info(e)},allowClear:!0,enterButton:Object(r.jsx)(ee.a,{"data-clipboard-target":"#copyLink",icon:Object(r.jsx)(pt.a,{})}),value:window.location.href})}),footer:null})},a.linkInput=null,a}return Object(s.a)(n,[{key:"render",value:function(){var e=this.props.viewOneCamera;return Object(r.jsxs)($e.a,{style:{height:"100%"},children:[Object(r.jsx)(ct,{}),Object(r.jsx)(xt,{style:{display:"none"},id:"chatElement",width:350,onClick:this.onCreateRoom,children:Object(r.jsx)(jt,{})}),Object(r.jsxs)($e.a,{children:[e?Object(r.jsx)(gt,{id:"localMedia",children:Object(r.jsxs)($e.a,{style:{height:"100%"},children:[Object(r.jsx)(xt,{width:150,id:"localVideos",style:{position:"absolute",zIndex:2},children:Object(r.jsx)(Ke,{})}),Object(r.jsx)(gt,{style:{overflow:"hidden"},id:"localMedia",children:Object(r.jsx)(be,{})})]})}):Object(r.jsx)(gt,{id:"multipleMedia",children:Object(r.jsx)($e.a,{style:{height:"100%"},children:Object(r.jsx)(ot,{})})}),Object(r.jsx)(Ot,{children:Object(r.jsx)(Ze,{onStopMic:this.onStopMic,onOpenMic:this.onOpenMic,onDisplayChat:this.onDisplayChat,onStartScreenShare:this.onStartScreenShare,onEndCall:this.onEndCall,onStopCamera:this.onStopCamera,onOpenCamera:this.onOpenCamera,onDisplayRemote:this.onDisplayRemote,onDisplayRoomInfo:this.onDisplayRoomInfo,onShareLink:this.onShareLink})})]}),e?Object(r.jsx)(xt,{style:{background:"#f0f2f5",width:"100%",display:this.props.remoteElementState.length>0?"block":"none"},width:150,id:"remoteVideos",children:Object(r.jsx)(me,{})}):null]})}}]),n}(a.Component);var Ct=Object(Y.b)((function(e){return{viewOneCamera:e.ui.viewOneCamera,remoteElementState:e.remoteElementState}}),(function(e){return{setModal:function(t){return e(A(t))}}}))(St),Rt=(a.Component,n(15)),Et="audioType",Tt="videoType",Mt="screenType",It=function e(t,n,r,a){var o=this;Object(c.a)(this,e),this.initRoomClient=Object(Z.a)(X.a.mark((function e(){var t;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.createRoom();case 2:if(t=e.sent,console.log(t),!t.roomname){e.next=12;break}return e.next=7,o.initSocket();case 7:return e.next=9,o.joinRoom(o.username,o.roomname,o.password);case 9:return e.next=11,o.produce(Tt,null);case 11:o.callback(o);case 12:case"end":return e.stop()}}),e)}))),this.initRTC=Object(Z.a)(X.a.mark((function e(){var t;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.getRouterCapabilities();case 2:return t=e.sent,e.next=5,o.loadDevice(t);case 5:return o.device=e.sent,e.next=8,o.initProducerTransport(o.device);case 8:return o.producerTransport=e.sent,e.next=11,o.initConsumeTransport(o.device);case 11:o.consumeTransport=e.sent;case 12:case"end":return e.stop()}}),e)}))),this.initSocket=function(){o.socket.on(Re,(function(e){console.log(e),J.dispatch(q(e))})),o.socket.on(Ce,function(){var e=Object(Z.a)(X.a.mark((function e(t){var n;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,t.id,e.next=3,o.getProducerOfRoom();case 3:h("info",n+" \u0111\xe3 tham gia v\xe0o cu\u1ed9c h\u1ecdp");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.socket.on(Se,function(){var e=Object(Z.a)(X.a.mark((function e(t){var n;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,t.id,e.next=3,o.getProducerOfRoom();case 3:h("warning",n+" \u0111\xe3 r\u1eddi kh\u1ecfi cu\u1ed9c h\u1ecdp");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.socket.on(we,(function(){o.exit(!1)})),o.socket.on(ze,(function(e){var t=e.consumerId,n=e.peerId,r=e.peerName;console.log("closing consumer:",t,n,r),o.closeConsumer(t,n,r)})),o.socket.on(Le,function(){var e=Object(Z.a)(X.a.mark((function e(t){var n,r,a;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(Rt.a)(J.getState().remoteElementState),r=X.a.mark((function e(r){var a,i,c,s,u,l,d,p;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t[r],i=a.producer_id,c=a.peerName,(s=a.peerId)===o.socket.id){e.next=7;break}return e.next=4,o.consume(i,c,s);case 4:u=e.sent,-1===(l=n.findIndex((function(e){return e.peerId==s})))?(d={video:[],audio:null,peerId:s,peerName:c},"video"===u.kind&&d.video.push(u),"audio"===u.kind&&(d.audio=u),n.push(d)):(p=n[l],"video"===u.kind&&p.video.push(u),"audio"===u.kind&&(p.audio=u));case 7:case"end":return e.stop()}}),e)})),a=0;case 3:if(!(a<t.length)){e.next=8;break}return e.delegateYield(r(a),"t0",5);case 5:a++,e.next=3;break;case 8:J.dispatch(F(n));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},this.createRoom=Object(Z.a)(X.a.mark((function e(){var t;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new f("https://"+window.serverIp+":"+window.port),o.socket=t.socket,o.socket.request=t.request,e.next=5,o.socket.request(Ie,{roomname:o.roomname,password:o.password});case 5:if(!e.sent){e.next=10;break}return e.abrupt("return",{roomname:o.roomname,password:o.password});case 10:return e.next=12,o.socket.request(ke,{roomname:o.roomname,password:o.password});case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e)}))),this.getProducerOfRoom=Object(Z.a)(X.a.mark((function e(){var t,n,r,a;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.socket.request(De);case 2:t=e.sent,n=[],r=X.a.mark((function e(r){var a,i,c,s,u,l,d,p;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t[r],i=a.producer_id,c=a.peerName,(s=a.peerId)===o.socket.id){e.next=7;break}return e.next=4,o.consume(i,c,s);case 4:u=e.sent,-1===(l=n.findIndex((function(e){return e.peerId==s})))?(d={video:[],audio:null,peerId:s,peerName:c},"video"===u.kind&&(d.video=[u]),"audio"===u.kind&&(d.audio=u),n.push(d)):(p=n[l],"video"===u.kind&&p.video.push(u),"audio"===u.kind&&(p.audio=u));case 7:case"end":return e.stop()}}),e)})),a=0;case 6:if(!(a<t.length)){e.next=11;break}return e.delegateYield(r(a),"t0",8);case 8:a++,e.next=6;break;case 11:J.dispatch(F(n));case 12:case"end":return e.stop()}}),e)}))),this.joinRoom=function(){var e=Object(Z.a)(X.a.mark((function e(t,n,r){return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.socket.request(Ce,{username:t,roomname:n,password:r});case 2:return e.next=4,o.initRTC();case 4:return e.next=6,o.getProducerOfRoom();case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.getRouterCapabilities=Object(Z.a)(X.a.mark((function e(){var t;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.socket.request(Ae);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),this.loadDevice=function(){var e=Object(Z.a)(X.a.mark((function e(t){var n;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n=new window.mediasoupClient.Device}catch(r){"UnsupportedError"===r.name&&console.error("browser not supported"),console.error(r)}return e.next=3,n.load({routerRtpCapabilities:t});case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.initProducerTransport=function(){var e=Object(Z.a)(X.a.mark((function e(t){var n,r;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.socket.request(Ne,{forceTcp:!1,rtpCapabilities:t.rtpCapabilities});case 2:return n=e.sent,(r=t.createSendTransport(n)).on("connect",function(){var e=Object(Z.a)(X.a.mark((function e(t,r,a){var i;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.dtlsParameters,e.prev=1,e.next=4,o.socket.request(_e,{dtlsParameters:i,transport_id:n.id});case 4:r(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),a(e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}()),r.on("produce",function(){var e=Object(Z.a)(X.a.mark((function e(t,n,a){var i,c,s,u,l,d;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.kind,c=t.rtpParameters,e.prev=1,s=r.id,e.next=5,o.socket.request(Pe,{producerTransportId:s,kind:i,rtpParameters:c});case 5:u=e.sent,l=u.producerId,d=u.socketId,n({id:l,socketId:d}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),a(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,n,r){return e.apply(this,arguments)}}()),r.on("connectionstatechange",(function(e){switch(e){case"connecting":case"connected":break;case"failed":r.close()}})),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.initConsumeTransport=function(){var e=Object(Z.a)(X.a.mark((function e(t){var n,r;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.socket.request(Ne,{forceTcp:!1});case 2:return n=e.sent,(r=t.createRecvTransport(n)).on("connect",function(){var e=Object(Z.a)(X.a.mark((function e(t,n,a){var i;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.dtlsParameters,e.prev=1,e.next=4,o.socket.request(_e,{transport_id:r.id,dtlsParameters:i});case 4:n(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),a(a);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}()),r.on("connectionstatechange",function(){var e=Object(Z.a)(X.a.mark((function e(t){return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="connecting"===e.t0?3:"connected"===e.t0?4:"failed"===e.t0?5:7;break;case 3:case 4:return e.abrupt("break",8);case 5:return r.close(),e.abrupt("break",8);case 7:return e.abrupt("break",8);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.produce=function(){var e=Object(Z.a)(X.a.mark((function e(t){var n,r,a,i,c,s,u,l,d,p=arguments;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=p.length>1&&void 0!==p[1]?p[1]:null,r={},a=!1,i=!1,e.t0=t,e.next=e.t0===Et?7:e.t0===Tt?10:e.t0===Mt?12:15;break;case 7:return r={audio:{deviceId:n},video:!1},a=!0,e.abrupt("break",16);case 10:return r={audio:!1,video:{width:{min:640,ideal:1920},height:{min:400,ideal:1080},deviceId:n}},e.abrupt("break",16);case 12:return r=!1,i=!0,e.abrupt("break",16);case 15:return e.abrupt("break",16);case 16:if(o.device.canProduce("video")||a){e.next=19;break}return console.error("cannot produce video"),e.abrupt("return");case 19:if(e.prev=19,!i){e.next=26;break}return e.next=23,navigator.mediaDevices.getDisplayMedia();case 23:e.t1=e.sent,e.next=29;break;case 26:return e.next=28,navigator.mediaDevices.getUserMedia(r);case 28:e.t1=e.sent;case 29:return c=e.t1,s=a?c.getAudioTracks()[0]:c.getVideoTracks()[0],u={track:s},t===Tt&&(u.encodings=[{rid:"r0",maxBitrate:1e5,scalabilityMode:"S1T3"},{rid:"r1",maxBitrate:3e5,scalabilityMode:"S1T3"},{rid:"r2",maxBitrate:9e5,scalabilityMode:"S1T3"}],u.codecOptions={videoGoogleStartBitrate:1e3},J.dispatch(j({stream:c}))),e.next=35,o.producerTransport.produce(u);case 35:(l=e.sent).on("trackended",(function(){console.log("producer trackend"),o.closeProducer(t)})),l.on("transportclose",(function(){console.log("producer transport close")})),l.on("close",(function(){console.log("closing producer")})),d=Object(R.a)({},J.getState().localElementState),e.t2=t,e.next=e.t2===Tt?43:e.t2===Et?47:e.t2===Mt?50:53;break;case 43:return o.listProduce.videos.push(l),d.videos.push({stream:c,producerId:l.id}),console.log(l.track),e.abrupt("break",54);case 47:return o.listProduce.audio.push(l),d.audio.push({stream:c,producerId:l.id}),e.abrupt("break",54);case 50:return o.listProduce.screenCast.push(l),d.screenCast.push({stream:c,producerId:l.id}),e.abrupt("break",54);case 53:return e.abrupt("break",54);case 54:J.dispatch(H(d)),e.next=60;break;case 57:e.prev=57,e.t3=e.catch(19),console.log(e.t3);case 60:case"end":return e.stop()}}),e,null,[[19,57]])})));return function(t){return e.apply(this,arguments)}}(),this.consume=function(){var e=Object(Z.a)(X.a.mark((function e(t,n,r){var a;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.getConsumeStream(t);case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.getConsumeStream=function(){var e=Object(Z.a)(X.a.mark((function e(t){var n,r,a,i,c,s,u,l,d;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.device.rtpCapabilities,e.next=3,o.socket.request(Ve,{rtpCapabilities:n,consumerTransportId:o.consumeTransport.id,producerId:t});case 3:return r=e.sent,a=null===r||void 0===r?void 0:r.params,i=a.id,c=a.kind,s=a.rtpParameters,u={},e.next=8,o.consumeTransport.consume({id:i,producerId:t,kind:c,rtpParameters:s,codecOptions:u});case 8:return(l=e.sent).on("trackended",(function(){console.log("consumer trackend")})),l.on("transportclose",(function(){console.log("consumer transportclose")})),(d=new MediaStream).addTrack(l.track),e.abrupt("return",{consumer:l,stream:d,kind:c});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.closeProducer=function(e){var t=Object(R.a)({},J.getState().localElementState);switch(e){case Tt:for(var n=o.listProduce.videos,r=0;r<n.length;r++){var a=n[r],i=a.id;o.socket.request(qe,{producer_id:i}),a.close()}o.listProduce.videos=[],t.videos=[];break;case Et:for(var c=o.listProduce.audio,s=0;s<c.length;s++){var u=c[s],l=u.id;o.socket.request(qe,{producer_id:l}),u.close()}o.listProduce.audio=[],t.audio=[];break;case Mt:for(var d=o.listProduce.screenCast,p=0;p<d.length;p++){var m=d[p],h=m.id;o.socket.request(qe,{producer_id:h}),m.close()}o.listProduce.screenCast=[],t.screenCast=[]}J.dispatch(H(t))},this.closeConsumer=function(e,t,n){for(var r=Object(Rt.a)(J.getState().remoteElementState),a=0;a<r.length;a++){var o,i=r[a];if((null===(o=i.audio)||void 0===o?void 0:o.consumer.id)===e)i.audio=null;else for(var c=0;c<i.video.length;c++){i.video[c].consumer.id===e&&i.video.splice(c,1)}}J.dispatch(F(r))},this.exit=Object(Z.a)(X.a.mark((function e(){var t=arguments;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length>0&&void 0!==t[0]&&t[0]){e.next=4;break}return e.next=4,o.socket.request(Ee);case 4:o.consumerTransport.close(),o.producerTransport.close(),o.socket.off(Ce),o.socket.off(Se),o.socket.off(we),o.socket.off(ze),o.socket.off(Le),window.close();case 12:case"end":return e.stop()}}),e)}))),this.getMessageInRoom=Object(Z.a)(X.a.mark((function e(){var t;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.socket.request(Me);case 2:t=e.sent,console.log(t),J.dispatch(q(t));case 5:case"end":return e.stop()}}),e)}))),this.sendMessageChat=function(){var e=Object(Z.a)(X.a.mark((function e(t){return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.socket.request(Te,t);case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.roomInfo=Object(Z.a)(X.a.mark((function e(){var t;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.socket.request(ye);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),this.changePassword=Object(Z.a)(X.a.mark((function e(){var t;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.socket.request(ge,Ue.password);case 2:t=e.sent,h("info",t);case 4:case"end":return e.stop()}}),e)}))),this.roomname=t,this.username=n,this.password=r,this.producerTransport=null,this.consumeTransport=null,this.device=null,this.listProduce={videos:[],audio:[],screenCast:[]},this.initRoomClient(),this.callback=a},Nt=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).onFinish=function(e){Ue.micEnable=r.state.micEnable,Ue.cameraEnable=r.state.cameraEnable;var t=e.roomName,n=e.displayName,a=e.password;r.onCreateRoom(t,n,a)},r.onCreateRoom=function(e,t,n){new It(e,t,n,(function(e){r.props.setRoomCreate(!0),window.roomClient=e}))},r.state={micEnable:!1,cameraEnable:!0},r}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsx)("div",{style:{display:"flex",width:"100%",height:"100%",alignItems:"center",justifyContent:"center"},children:this.props.roomCreateState?Object(r.jsx)(Ct,{}):Object(r.jsx)("div",{children:Object(r.jsxs)(ht.a,{ref:function(t){return e.formRef=t},name:"control-ref",onFinish:this.onFinish,children:[Object(r.jsx)(ht.a.Item,{name:"roomName",label:"T\xean cu\u1ed9c h\u1ecdp",rules:[{required:!0}],children:Object(r.jsx)(ut.a,{})}),Object(r.jsx)(ht.a.Item,{name:"displayName",label:"T\xean hi\u1ec3n th\u1ecb",rules:[{required:!0}],children:Object(r.jsx)(ut.a,{})}),Object(r.jsx)(ht.a.Item,{name:"password",label:"M\u1eadt kh\u1ea9u cu\u1ed9c h\u1ecdp",children:Object(r.jsx)(ut.a,{})}),Object(r.jsxs)(ht.a.Item,{children:[Object(r.jsx)(ee.a,{onClick:function(){e.setState({micEnable:!e.state.micEnable})},icon:this.state.micEnable?Object(r.jsx)("i",{className:"material-icons",children:"mic"}):Object(r.jsx)("i",{className:"material-icons",children:"mic_off"})}),Object(r.jsx)(ee.a,{onClick:function(){e.setState({cameraEnable:!e.state.cameraEnable})},icon:this.state.cameraEnable?Object(r.jsx)("i",{className:"material-icons",children:"videocam"}):Object(r.jsx)("i",{className:"material-icons",children:"videocam_off"})})]}),Object(r.jsx)(ht.a.Item,{children:Object(r.jsx)(ee.a,{type:"primary",htmlType:"submit",children:"T\u1ea1o cu\u1ed9c h\u1ecdp/Tham gia v\xe0o cu\u1ed9c h\u1ecdp"})})]})})})}}]),n}(a.Component);var _t=Object(Y.b)((function(e){return{roomCreateState:e.roomCreateState}}),(function(e){return{setRoomCreate:function(t){return e(x(t))}}}))(Nt),Pt=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){};var a=new f("https://"+window.serverIp+":"+window.port);return r.socket=a.socket,r.socket.request=a.request,r.name="Dr.admin",window.name=r.name,window.socket=r.socket,r}return Object(s.a)(n,[{key:"render",value:function(){return console.log(J.getState()),Object(r.jsx)(Y.a,{store:J,children:Object(r.jsx)("div",{style:{width:"100%",height:"100vh"},children:Object(r.jsx)(_t,{})})})}}]),n}(a.Component),Vt=(n(362),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,378)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),o(e),i(e)}))});i.a.render(Object(r.jsx)(Pt,{}),document.getElementById("root")),Vt()}},[[363,1,2]]]);
//# sourceMappingURL=main.c60904dc.chunk.js.map