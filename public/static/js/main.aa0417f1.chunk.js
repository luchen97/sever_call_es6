(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{168:function(e,t,n){},276:function(e,t,n){},281:function(e,t,n){},311:function(e,t,n){},312:function(e,t,n){},317:function(e,t,n){},436:function(e,t,n){},437:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(0),o=n(24),i=n.n(o),c=n(7),s=n(8),l=n(9),d=n(11),u=n(91),p=n(448),m=function(e,t){p.a[e]({message:"Th\xf4ng b\xe1o!",description:t,placement:"bottomRight"})},h=(n(275),n(276),n(74)),f="SET_LARGE_VIDEO",j=function(e){return{type:f,payload:e}},v="SET_ROOMCREATE",b=function(e){return{type:v,payload:e}},O="SET_STREAM",x={local:[],remote:[]},g=function(e){return{type:O,payload:e}},y="SET_USERONROOM",k=[],w=function(e){return{type:y,payload:e}},S=n(5),C="SET_VIEW_ONE_CAMERA",R={viewOneCamera:!0},E=function(){return{type:C}},I="SET_REMOTE_STREAM",N=new Map,M="SET_MODAL",T={visible:!1,header:"",render:null},_=function(e){return{type:M,payload:e}},V="SET_MESSAGE",A=[],P=function(e){return{type:V,payload:e}},D="SET_REMOTE_ELEMENT",L=[],U=function(e){return{type:D,payload:e}},z="SET_LOCAL_ELEMENT",F={videos:[],audio:[],screenCast:[]},W=function(e){return{type:z,payload:e}},H=Object(h.c)({streamRemoteState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case I:return e=t.payload;default:return e}},streamState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return e=t.payload;default:return e}},largeVideoState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return e=t.payload;default:return e}},userOnRoomState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return e=t.payload;default:return e}},roomCreateState:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case v:return e=t.payload;default:return e}},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:return e.viewOneCamera=!e.viewOneCamera,Object(S.a)({},e);default:return e}},modalState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M:return e=t.payload;default:return e}},messageState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case V:return e=t.payload;default:return e}},remoteElementState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D:return e=t.payload;default:return e}},localElementState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case z:return e=t.payload;default:return e}}}),B=[n(201).a],q=Object(h.d)(H,h.a.apply(void 0,B)),G=n(23),J=n(4),K=n.n(J),Z=n(19),Q=n(10),Y=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).componentDidMount=function(){var t;e.videoRef.srcObject=null===(t=e.props)||void 0===t?void 0:t.srcObject},e.componentDidUpdate=function(t){var n;t!==e.props&&(e.videoRef.srcObject=null===(n=e.props)||void 0===n?void 0:n.srcObject)},e.onClick=function(){e.props.onClick(e.videoRef)},e.componentWillUnmount=function(){console.log("video unmount",e.props),e.props.srcObject.getTracks().forEach((function(e){return e.stop()}))},e}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsx)("video",{id:"video",autoPlay:!0,ref:function(t){e.videoRef=t},width:"100%",height:100,style:{background:"black",paddingTop:5},onClick:this.onClick})}}]),n}(a.PureComponent),X=(a.PureComponent,n(48)),$=n(54),ee=n.n($),te=(new Map,n(281),["#f56a00","#7265e6","#ffbf00","#00a2ae,#885569","#7265e6","#885569","#00a2ae,#885569","#885569"]),ne=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){var e,t,n=r.props.item;r.audioRef.srcObject=null===n||void 0===n||null===(e=n.audio)||void 0===e?void 0:e.stream,r.videoRef.srcObject=null===n||void 0===n||null===(t=n.video)||void 0===t?void 0:t.stream,r.videoRef.srcObject?r.setState({hasVideo:!0}):r.setState({hasVideo:!1})},r.componentDidUpdate=function(e){if(r.props.item!==e.item){var t,n,a=r.props.item;r.audioRef.srcObject=null===a||void 0===a||null===(t=a.audio)||void 0===t?void 0:t.stream,r.videoRef.srcObject=null===a||void 0===a||null===(n=a.video)||void 0===n?void 0:n.stream,r.videoRef.srcObject?r.setState({hasVideo:!0}):r.setState({hasVideo:!1})}},r.mute=function(e){e.preventDefault();var t=r.state.mute;r.audioRef.muted=!t,r.setState({mute:!t})},r.setLargeVideo=function(e){r.props.onHandleSetLargeVideos(),q.dispatch(j({stream:r.videoRef.srcObject}))},r.state={mute:!1,hasVideo:!1},r}return Object(s.a)(n,[{key:"render",value:function(){var e,t,n=this;return Object(r.jsxs)("div",{id:this.props.item.peerId,onClick:this.setLargeVideo,style:{border:this.props.item.active?"2px solid red":"none",position:"relative",width:"100%",height:"auto",display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(r.jsx)("span",{style:{color:"#ddd",fontWeight:"bold",position:"absolute",maxWidth:"80%",bottom:5},children:null===(e=this.props.item)||void 0===e?void 0:e.peerName}),this.state.mute?Object(r.jsx)(X.a,{onClick:this.mute,type:"link",shape:"circle",danger:!0,style:{position:"absolute",top:5,left:5,zIndex:10},icon:Object(r.jsx)("i",{className:"material-icons",children:"volume_off"})}):Object(r.jsx)(X.a,{onClick:this.mute,type:"link",shape:"circle",danger:!0,style:{position:"absolute",top:5,left:5,zIndex:10},icon:Object(r.jsx)("i",{className:"material-icons",children:"volume_up"})}),this.state.hasVideo?null:Object(r.jsx)("div",{id:"placeHodler",style:{color:"#ddd",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",borderRadius:"50%",width:50,height:50},children:Object(r.jsx)(ee.a,{style:{backgroundColor:"".concat(te[Math.floor(10*Math.random())]),verticalAlign:"middle"},size:"large",children:null===(t=this.props.item)||void 0===t?void 0:t.peerName})}),Object(r.jsx)("video",{ref:function(e){n.videoRef=e},id:"video",autoPlay:!0,width:"100%",height:100,style:{background:"black",border:"2px solid #224567"}}),Object(r.jsx)("audio",{ref:function(e){n.audioRef=e},id:"audio",autoPlay:!0})]})}}]),n}(a.Component);Object(G.b)((function(e){return{streamRemoteState:e.streamRemoteState,remoteElementState:e.remoteElementState}}),null)(ne);var re=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).componentDidMount=function(){var t;e.audioRef.srcObject=null===(t=e.props)||void 0===t?void 0:t.srcObject},e.componentDidUpdate=function(t){var n;t!==e.props&&(e.audioRef.srcObject=null===(n=e.props)||void 0===n?void 0:n.srcObject)},e}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props.muted;return Object(r.jsx)("audio",{style:{width:"100%",height:"80px",display:"none"},ref:function(t){e.audioRef=t},id:"audio",autoPlay:!t})}}]),n}(a.PureComponent),ae=["#f56a00","#7265e6","#ffbf00","#00a2ae,#885569","#7265e6","#885569","#00a2ae,#885569","#885569"],oe=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).onVideoClick=function(e){r.props.onHandleSetLargeVideos(),q.dispatch(j({stream:e.srcObject}))},r.state={muted:!1},r}return Object(s.a)(n,[{key:"render",value:function(){var e,t,n,a,o=this,i=this.state.muted;return console.log(this.props.item),Object(r.jsxs)("div",{className:"videos-user-component",children:[Object(r.jsx)(X.a,{style:{position:"absolute",top:0,left:0,zIndex:2},onClick:function(){o.setState({muted:!i})},icon:i?Object(r.jsx)("i",{className:"material-icons",children:"volume_off"}):Object(r.jsx)("i",{className:"material-icons",children:"volume_up"})}),Object(r.jsx)("div",{className:"peerName",children:null===(e=this.props.item)||void 0===e?void 0:e.peerName}),0===this.props.item.video.length?Object(r.jsx)("div",{id:"placeHodler",style:{color:"#ddd",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",borderRadius:"50%",width:50,height:50},children:Object(r.jsx)(ee.a,{style:{backgroundColor:"".concat(ae[Math.floor(10*Math.random())]),verticalAlign:"middle"},size:"large",children:null===(t=this.props.item)||void 0===t?void 0:t.peerName})}):null,this.props.item.video.map((function(e,t){return Object(r.jsx)(Y,{srcObject:e.stream,onClick:o.onVideoClick},t)})),Object(r.jsx)(re,{srcObject:null===(n=this.props.item)||void 0===n||null===(a=n.audio)||void 0===a?void 0:a.stream,muted:i})]})}}]),n}(a.Component),ie=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).onHandleSetLargeVideo=function(e,t){r.setActive(t)},r.setActive=function(e){for(var t=Object(S.a)({},r.props.streamState),n=t.local,a=0;a<n.length;a++){n[a].active=!1}for(var o=0;o<r.props.userOnRoomState.length;o++){var i=r.props.userOnRoomState[o];i.active=o===e}r.props.setUserOnRoom(r.props.userOnRoomState),r.props.setStream(Object(S.a)({},t))},r.audioRef=null,r}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return console.log(this.props.remoteElementState),Object(r.jsx)("div",{className:"remote-video-component",children:this.props.remoteElementState.map((function(t,n){return Object(r.jsx)(oe,{item:t,onHandleSetLargeVideos:function(){return e.onHandleSetLargeVideo(t,n)}},n)}))})}}]),n}(a.Component);var ce=Object(G.b)((function(e){return{streamState:e.streamState,userOnRoomState:e.userOnRoomState,remoteElementState:e.remoteElementState}}),(function(e){return{setLargeVideo:function(t){return e(j(t))},setStream:function(t){return e(g(t))},setUserOnRoom:function(t){return e(w(t))}}}))(ie),se=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).onVideoClick=function(e){q.dispatch(j({stream:e.srcObject}))},e}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsxs)("div",{className:"local-video-component",children:[this.props.localElementState.videos.map((function(t,n){var a;return Object(r.jsxs)("div",{className:"local-video-item",children:[Object(r.jsxs)("span",{style:{color:"#ddd",textShadow:"1px 1px black",fontWeight:"bold",position:"absolute",maxWidth:"80%",bottom:5},children:[null===(a=window.roomClient)||void 0===a?void 0:a.username," (Me)"]}),Object(r.jsx)(Y,{srcObject:null===t||void 0===t?void 0:t.stream,onClick:e.onVideoClick})]},n)})),this.props.localElementState.screenCast.map((function(t,n){var a;return Object(r.jsxs)("div",{className:"local-video-item share-screen",children:[Object(r.jsxs)("span",{style:{color:"#ddd",textShadow:"1px 1px black",fontWeight:"bold",position:"absolute",maxWidth:"80%",bottom:5},children:[null===(a=window.roomClient)||void 0===a?void 0:a.username," (Me)"]}),Object(r.jsx)(Y,{srcObject:null===t||void 0===t?void 0:t.stream,onClick:e.onVideoClick})]},n)}))]})}}]),n}(a.Component);var le=Object(G.b)((function(e){return{localElementState:e.localElementState}}),(function(e){return{setLargeVideo:function(t){return e(j(t))}}}))(se),de=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return Object(r.jsx)("div",{style:{width:"100%",height:"100%"},children:Object(r.jsx)(ce,{})})}}]),n}(a.Component);var ue=Object(G.b)((function(e){return{streamState:e.streamState}}),null)(de),pe=n(203),me=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).state={},r.count=0,r}return Object(s.a)(n,[{key:"render",value:function(){return Object(r.jsx)(pe.a,{seconds:0,minutes:0,hours:0,render:function(e){var t=e.formatted;e.hours,e.minutes,e.seconds;return Object(r.jsx)("div",{style:{position:"absolute",zIndex:2,background:"#fff",fontWeight:600,top:5,right:5},children:Object(r.jsxs)("p",{style:{margin:4,display:"flex",alignItems:"center",fontSize:12},children:[Object(r.jsx)("i",{style:{fontSize:17},className:"material-icons",children:"alarm"}),t]})})}})}}]),n}(a.Component),he=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).componentDidMount=function(){var t;e.videoRef&&(e.videoRef.srcObject=null===(t=e.props.largeVideoState)||void 0===t?void 0:t.stream)},e.componentDidUpdate=function(t){var n;t.largeVideoState!==e.props.largeVideoState&&(e.videoRef&&(e.videoRef.srcObject=null===(n=e.props.largeVideoState)||void 0===n?void 0:n.stream))},e}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return console.log(this.props.largeVideoState),Object(r.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%",background:"black"},children:[Object(r.jsx)(me,{}),this.props.largeVideoState?Object(r.jsx)("video",{autoPlay:!0,ref:function(t){e.videoRef=t},style:{position:"relative",width:"100%",height:"100%",background:"black"}}):Object(r.jsx)("div",{style:{width:"100%",height:"100%",background:"black",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(r.jsx)("img",{src:"./icons/avatar.png",alt:"",style:{width:"450px",height:"450px",objectFit:"contain",border:"1px solid #423e3e",borderRadius:"50%"}})})]})}}]),n}(a.Component);var fe=Object(G.b)((function(e){return{largeVideoState:e.largeVideoState}}),null)(he),je=(n(168),n(17),n(204),n(449)),ve="disconnect",be="SOCKET_USER_LEFT_ROOM",Oe="SOCKET_USER_JOIN_ROOM",xe="INCOMMING_MESSAGE",ge="NEW_PRODUCER",ye="CLOSE_CONSUME",ke={micEnable:!1,cameraEnable:!1,password:void 0},we=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=Object(Q.a)(K.a.mark((function e(){var t,n,a,o;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.navigator.mediaDevices.enumerateDevices();case 2:for(t=e.sent,n=[],a=0;a<t.length;a++)"videoinput"===(o=t[a]).kind&&n.push({deviceInfo:o,active:!1});r.setState({video:n});case 6:case"end":return e.stop()}}),e)}))),r.onActiveOptionCamera=function(){var e=Object(Q.a)(K.a.mark((function e(t,n){var a,o,i,c,s,l,d,u,p,m,h;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=window.roomClient,o=a.localUser,i=r.state.video,c=0;case 4:if(!(c<i.length)){e.next=27;break}if(s=i[c],c!==n){e.next=23;break}return s.active=!0,o.closeProducerWithType("camera"),l={video:{deviceId:s.deviceInfo.deviceId},audio:!1},d=navigator.mediaDevices,e.next=13,d.getUserMedia(l);case 13:return u=e.sent,p=u.getVideoTracks()[0],e.next=17,null===o||void 0===o?void 0:o.produce(a.routerCapabilities,a.producerTransport,p,"camera");case 17:m=e.sent,(h=Object(S.a)({},q.getState().localElementState)).videos.push({producer:m,stream:u}),q.dispatch(W(h)),e.next=24;break;case 23:s.active=!1;case 24:c++,e.next=4;break;case 27:r.setState({video:i});case 28:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.state={video:[]},r}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsxs)("div",{className:"micOption",children:[Object(r.jsxs)("div",{className:"row",children:[Object(r.jsx)("i",{className:"material-icons",children:" videocam"}),Object(r.jsx)("h2",{children:"Videos"})]}),this.state.video.map((function(t,n){return Object(r.jsxs)("div",{onClick:function(){return e.onActiveOptionCamera(t,n)},children:[" ",Object(r.jsxs)("div",{className:"row padding",children:[t.active?Object(r.jsx)("i",{className:"material-icons",children:" check"}):Object(r.jsx)("i",{className:"material-icons",children:" videocam"}),Object(r.jsx)("span",{children:t.deviceInfo.label})]})]},"camera"+n)}))]},"camera")}}]),n}(a.Component),Se=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return Object(r.jsx)("div",{style:{width:"100%",height:"100%"},children:Object(r.jsx)(le,{})})}}]),n}(a.Component);var Ce=Object(G.b)((function(e){return{streamState:e.streamState}}),null)(Se),Re=n(445),Ee=n(447),Ie=(n(311),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).openFullscreen=function(){var e=document.documentElement;r.state.fullscreen?document.exitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),r.setState({fullscreen:!r.state.fullscreen})},r.state={fullscreen:!1},r}return Object(s.a)(n,[{key:"render",value:function(){return Object(r.jsxs)("div",{className:"menuOption",children:[Object(r.jsxs)("div",{onClick:function(){},children:[" ",Object(r.jsxs)("div",{className:"row padding",children:[Object(r.jsx)("i",{className:"material-icons",children:" high_quality"}),Object(r.jsx)("span",{children:"Ch\u1ea5t l\u01b0\u1ee3ng"})]})]}),Object(r.jsx)("div",{onClick:this.openFullscreen,children:this.state.fullscreen?Object(r.jsxs)("div",{className:"row padding",children:[Object(r.jsx)("i",{className:"material-icons",children:" fullscreen_exit"}),Object(r.jsx)("span",{children:"Tho\xe1t to\xe0n m\xe0n h\xecnh"})]}):Object(r.jsxs)("div",{className:"row padding",children:[Object(r.jsx)("i",{className:"material-icons",children:" fullscreen"}),Object(r.jsx)("span",{children:"To\xe0n m\xe0n h\xecnh"})]})}),Object(r.jsxs)("div",{onClick:function(){},children:[" ",Object(r.jsxs)("div",{className:"row padding",children:[Object(r.jsx)("i",{className:"material-icons",children:" mic"}),Object(r.jsx)("span",{children:"Ghi \xe2m"})]})]}),Object(r.jsxs)("div",{onClick:function(){},children:[" ",Object(r.jsxs)("div",{className:"row padding",children:[Object(r.jsx)("i",{className:"material-icons",children:" videocam"}),Object(r.jsx)("span",{children:"Quay video"})]})]})]})}}]),n}(a.Component)),Ne=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=Object(Q.a)(K.a.mark((function e(){var t,n,a,o,i;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.navigator.mediaDevices.enumerateDevices();case 2:for(t=e.sent,n=[],a=[],o=0;o<t.length;o++)"audioinput"===(i=t[o]).kind&&n.push({deviceInfo:i,active:"default"===i.deviceId}),"audiooutput"===i.kind&&a.push({deviceInfo:i,active:"default"===i.deviceId});r.setState({mic:n,speaker:a});case 7:case"end":return e.stop()}}),e)}))),r.onActiveOptionMic=function(e,t){for(var n=r.state.mic,a=0;a<n.length;a++){var o=n[a];o.active=a===t}r.setState({mic:n})},r.onActiveOptionCamera=function(e,t){for(var n=r.state.speaker,a=0;a<n.length;a++){var o=n[a];o.active=a===t}r.setState({speaker:n})},r.state={mic:[],speaker:[]},r}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsxs)("div",{className:"micOption",children:[Object(r.jsxs)("div",{className:"row",children:[Object(r.jsx)("i",{className:"material-icons",children:" mic"}),Object(r.jsx)("h2",{children:"Microphones"})]}),this.state.mic.map((function(t,n){return Object(r.jsx)("div",{onClick:function(){return e.onActiveOptionMic(t,n)},className:t.active?"active":"",children:Object(r.jsxs)("div",{className:"row padding",children:[t.active?Object(r.jsx)("i",{className:"material-icons",children:" check"}):Object(r.jsx)("i",{className:"material-icons",children:" mic"}),Object(r.jsx)("span",{children:t.deviceInfo.label})]})},"mic"+n)})),Object(r.jsxs)("div",{className:"row",children:[Object(r.jsx)("i",{className:"material-icons",children:" volume_up"}),Object(r.jsx)("h2",{children:"Speaker"})]}),this.state.speaker.map((function(t,n){return Object(r.jsx)("div",{onClick:function(){return e.onActiveOptionCamera(t,n)},className:t.active?"active":"",children:Object(r.jsxs)("div",{className:"row padding",children:[t.active?Object(r.jsx)("i",{className:"material-icons",children:" check"}):Object(r.jsx)("i",{className:"material-icons",children:" volume_up"}),Object(r.jsx)("span",{children:t.deviceInfo.label})]})},"speaker"+n)}))]},"mic")}}]),n}(a.Component),Me=(n(312),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).onChangeView=function(){console.log("onChangeView"),r.props.setViewOneCamera()},r.state={openCamera:ke.cameraEnable,openMic:ke.micEnable},r}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props.userOnRoomState;return Object(r.jsxs)("div",{className:"footerTool",style:{width:"100%",height:"100%",justifyContent:"center",alignItems:"center",display:"flex",position:"relative"},children:[Object(r.jsxs)("div",{style:{position:"absolute",left:0,display:"flex"},children:[Object(r.jsx)(Re.a,{size:"default",count:this.props.messageState.length,children:Object(r.jsx)(X.a,{style:{margin:"0px 5px"},onClick:this.props.onDisplayChat,size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"chat"})})}),Object(r.jsx)(X.a,{style:{margin:"0px 5px"},onClick:this.props.onDisplayRoomInfo,size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"security"})}),Object(r.jsx)(Ee.a,{overlay:Object(r.jsx)(Ie,{}),trigger:["click"],children:Object(r.jsx)(X.a,{style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"menu"})})}),","]}),Object(r.jsx)(X.a,{onClick:this.props.onStartScreenShare,style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"tv"})}),this.state.openMic?Object(r.jsxs)("div",{style:{position:"relative"},children:[Object(r.jsx)(X.a,{onClick:function(){e.props.onStopMic(),e.setState({openMic:!1})},style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"mic"})}),Object(r.jsx)(Ee.a,{forceRender:!0,trigger:["click"],overlay:Object(r.jsx)(Ne,{}),children:Object(r.jsx)(X.a,{size:"small",shape:"circle",style:{position:"absolute",bottom:-3,right:-3},icon:Object(r.jsx)("i",{className:"material-icons",children:"expand_more"})},"dasda")})]},"mic"):Object(r.jsx)(X.a,{onClick:function(){e.props.onOpenMic(),e.setState({openMic:!0})},style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"mic_off"})}),Object(r.jsx)(X.a,{style:{margin:"0px 5px"},size:"large",type:"primary",shape:"circle",danger:!0,icon:Object(r.jsx)("i",{className:"material-icons",children:"call_end"}),onClick:this.props.onEndCall}),this.state.openCamera?Object(r.jsxs)("div",{style:{position:"relative"},children:[Object(r.jsx)(X.a,{onClick:function(){e.props.onStopCamera(),e.setState({openCamera:!1})},style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"videocam"})}),Object(r.jsx)(Ee.a,{forceRender:!0,trigger:["click"],overlay:Object(r.jsx)(we,{}),children:Object(r.jsx)(X.a,{size:"small",shape:"circle",style:{position:"absolute",bottom:-3,right:-3},icon:Object(r.jsx)("i",{className:"material-icons",children:"expand_more"})})})]},"camera"):Object(r.jsx)(X.a,{onClick:function(){e.props.onOpenCamera(),e.setState({openCamera:!0})},style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"videocam_off"})}),Object(r.jsxs)("div",{style:{position:"absolute",right:0,display:"flex"},children:[t.length>1?Object(r.jsx)(X.a,{style:{margin:"0px 5px"},size:"large",onClick:this.onChangeView,shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"grid_on"})}):null,Object(r.jsx)(X.a,{onClick:this.props.onShareLink,style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"person_add"})}),Object(r.jsx)(X.a,{onClick:this.props.onDisplayRemote,style:{margin:"0px 5px"},size:"large",shape:"circle",icon:Object(r.jsx)("i",{className:"material-icons",children:"swap_horiz"})})]})]})}}]),n}(a.Component));var Te=Object(G.b)((function(e){return{streamState:e.streamState,userOnRoomState:e.userOnRoomState,messageState:e.messageState}}),(function(e){return{setViewOneCamera:function(){return e(E())}}}))(Me),_e=n(446),Ve=n(443),Ae=["#f56a00","#7265e6","#ffbf00","#00a2ae,#885569","#7265e6","#885569","#00a2ae,#885569","#885569"],Pe=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){var e,t,n=r.props.streamRemoteState.get(r.props.item.id);r.audioRef.srcObject=null===n||void 0===n||null===(e=n.audio)||void 0===e?void 0:e.stream,r.videoRef.srcObject=null===n||void 0===n||null===(t=n.video)||void 0===t?void 0:t.stream,r.videoRef.srcObject?r.setState({hasVideo:!0}):r.setState({hasVideo:!1})},r.componentDidUpdate=function(e){if(r.props.streamRemoteState!==e.streamRemoteState){var t,n,a=r.props.streamRemoteState.get(r.props.item.id);r.audioRef.srcObject=null===a||void 0===a||null===(t=a.audio)||void 0===t?void 0:t.stream,r.videoRef.srcObject=null===a||void 0===a||null===(n=a.video)||void 0===n?void 0:n.stream,r.videoRef.srcObject?r.setState({hasVideo:!0}):r.setState({hasVideo:!1})}},r.mute=function(e){e.preventDefault();var t=r.state.mute;r.audioRef.muted=!t,r.setState({mute:!t})},r.setLargeVideo=function(e){r.props.onHandleSetLargeVideos(),q.dispatch(j({stream:r.videoRef.srcObject})),r.props.setViewOneCamera(!0)},r.state={mute:!1,hasVideo:!1},r.audioRef=null,r.videoRef=null,r}return Object(s.a)(n,[{key:"render",value:function(){var e,t,n,a=this,o=this.props.elementWidth;return Object(r.jsx)("div",{className:"media-element",style:{width:"".concat(o,"%"),height:"".concat(16*o/9,"%")},children:Object(r.jsx)("div",{className:"media-element-container",children:Object(r.jsxs)("div",{id:this.props.item.id,onClick:this.setLargeVideo,style:{border:this.props.item.active?"2px solid red":"none",position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(r.jsx)("span",{style:{color:"#ddd",fontWeight:"bold",position:"absolute",maxWidth:"80%",bottom:5},children:null===(e=this.props.item)||void 0===e?void 0:e.name}),this.state.mute?Object(r.jsx)(X.a,{onClick:this.mute,type:"link",shape:"circle",danger:!0,style:{position:"absolute",top:5,left:5,zIndex:10},icon:Object(r.jsx)("i",{className:"material-icons",children:"volume_off"})}):Object(r.jsx)(X.a,{danger:!0,onClick:this.mute,type:"link",shape:"circle",style:{position:"absolute",top:5,left:5,zIndex:10},icon:Object(r.jsx)("i",{className:"material-icons",children:"volume_up"})}),this.state.hasVideo?null:Object(r.jsx)("div",{id:"placeHodler",style:{color:"#ddd",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",borderRadius:"50%",width:200,height:200},children:Object(r.jsx)(ee.a,{style:{backgroundColor:"".concat(Ae[Math.floor(10*Math.random())]),verticalAlign:"middle",width:"100%",height:"100%"},size:"large",children:null===(t=this.props.item)||void 0===t||null===(n=t.name.match(/\b([A-Z])/g))||void 0===n?void 0:n.join("")})}),Object(r.jsx)("video",{ref:function(e){a.videoRef=e},id:"video",autoPlay:!0,width:"100%",height:"100%",style:{background:"black",border:"2px solid #224567"}}),Object(r.jsx)("audio",{ref:function(e){a.audioRef=e},id:"audio",autoPlay:!0})]})})})}}]),n}(a.Component);var De=Object(G.b)((function(e){return{streamRemoteState:e.streamRemoteState}}),(function(e){return{setViewOneCamera:function(t){return e(E())}}}))(Pe),Le=(n(317),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){var e=r.props.userOnRoomState;e.length<5?r.setState({widthMediaElement:100/e.length}):r.setState({widthMediaElement:25})},r.componentDidUpdate=function(e){var t=r.props.userOnRoomState;e.userOnRoomState!==t&&(t.length<5?r.setState({widthMediaElement:100/t.length}):r.setState({widthMediaElement:25}),t.length<2&&r.props.setViewOneCamera(!0))},r.onHandleSetLargeVideo=function(e,t){r.setActive(t)},r.setActive=function(e){for(var t=Object(S.a)({},r.props.streamState),n=t.local,a=0;a<n.length;a++){n[a].active=!1}for(var o=Array.from(r.props.userOnRoomState),i=0;i<o.length;i++){var c=o[i];c.active=i===e}r.props.setUserOnRoom(o),r.props.setStream(Object(S.a)({},t))},r.state={widthMediaElement:0},r}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props.userOnRoomState,n=this.state.widthMediaElement;return Object(r.jsx)("div",{className:"multipleMedia__container",children:t.map((function(t,a){return Object(r.jsx)(De,{item:t,elementWidth:n,onHandleSetLargeVideos:e.onHandleSetLargeVideo},a)}))})}}]),n}(a.Component));var Ue,ze=Object(G.b)((function(e){return{viewOneCamera:e.ui.viewOneCamera,userOnRoomState:e.userOnRoomState,streamState:e.streamState}}),(function(e){return{setViewOneCamera:function(t){return e(E())},setStream:function(t){return e(g(t))},setUserOnRoom:function(t){return e(w(t))}}}))(Le),Fe=n(207),We=n.n(Fe),He=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).handleCancel=function(t){e.props.setModal({visible:!1,header:"",render:null})},e.onOk=Object(Q.a)(K.a.mark((function e(){var t;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue.post("/call/changeRoomPassword",{roomname:window.roomClient.roomname,password:ke.password});case 2:t=e.sent,m("info",t.message);case 4:case"end":return e.stop()}}),e)}))),e}return Object(s.a)(n,[{key:"render",value:function(){return console.log(this.props.modalState),Object(r.jsx)(Ve.a,{title:this.props.modalState.header,visible:this.props.modalState.visible,onCancel:this.handleCancel,onOk:this.onOk,closable:!1,children:this.props.modalState.render})}}]),n}(a.Component);var Be=Object(G.b)((function(e){return{modalState:e.modalState}}),(function(e){return{setModal:function(t){return e(_(t))}}}))(He),qe=n(440),Ge=n(444),Je=n(450),Ke=n(451),Ze=n(452),Qe=n(441),Ye=n(442),Xe=_e.a.Footer,$e=_e.a.Content,et=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).sendMessage=function(t){var n,r=Ue.post("/call/sendMessage",{roomname:window.roomClient.roomname,message:t.message,userId:window.roomClient.localUser.id});console.log(r),null===(n=e.formRef)||void 0===n||n.resetFields()},e}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsxs)(_e.a,{style:{width:350,height:"100%"},children:[Object(r.jsx)($e,{style:{width:"100%"},children:this.props.messageState.map((function(e,t){return Object(r.jsxs)(qe.a,{children:[Object(r.jsx)(Qe.a,{span:3,style:{alignItems:"flex-end",display:"flex",padding:5},children:e.id===window.roomClient.socket.id?null:Object(r.jsx)(ee.a,{src:"./icons/avatar.png"})}),Object(r.jsxs)(Qe.a,{span:21,children:[e.id===window.roomClient.socket.id?null:Object(r.jsx)(qe.a,{style:{width:"100%"},children:Object(r.jsx)("div",{style:{fontSize:11,color:"#90949c"},children:e.name})}),Object(r.jsx)(qe.a,{style:{width:"100%"},children:Object(r.jsx)("div",{style:e.id===window.roomClient.socket.id?{marginTop:2,marginBottom:2,marginRight:5,background:"#42a5f5",color:"#fff",borderRadius:"20px 20px 3px 20px",display:"block",maxWidth:"75%",padding:"7px 13px 7px 13px",marginLeft:"auto",fontSize:13}:{marginTop:2,marginBottom:2,background:"#ddd",borderRadius:"20px 20px 20px 3px",display:"block",maxWidth:"75%",padding:"7px 13px 7px 13px",float:"left",fontSize:13,color:"#444950"},children:e.message})})]})]},t)}))}),Object(r.jsx)(Xe,{style:{padding:0,margin:10,display:"flex",justifyContent:"center",alignItems:"center"},children:Object(r.jsxs)(Ye.a,{ref:function(t){return e.formRef=t},layout:"inline",name:"horizontal_login",onFinish:this.sendMessage,children:[Object(r.jsx)(Ye.a.Item,{name:"message",children:Object(r.jsx)(Ge.a,{placeholder:"Nh\u1eadp tin nh\u1eafn"})}),Object(r.jsx)(Ye.a.Item,{children:Object(r.jsx)(X.a,{style:{justifyContent:"center",alignItems:"center",display:"flex"},type:"primary",htmlType:"submit",icon:Object(r.jsx)("i",{className:"material-icons",children:"send"})})})]})})]})}}]),n}(a.Component);var tt=Object(G.b)((function(e){return{messageState:e.messageState}}),null)(et),nt=(_e.a.Header,_e.a.Footer),rt=_e.a.Sider,at=_e.a.Content,ot=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).componentDidMount=Object(Q.a)(K.a.mark((function e(){var t,n,r,o,i,c,s,l;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ke.cameraEnable){e.next=3;break}return e.next=3,a.onOpenCamera();case 3:if(!ke.micEnable){e.next=6;break}return e.next=6,a.onOpenMic();case 6:return n=window.roomClient,r=n.localUser,e.next=10,null===(t=window.roomClient)||void 0===t?void 0:t.getProducerInRoom();case 10:o=e.sent,i=o.data,c=Object(Z.a)(a.props.remoteElementState),s=K.a.mark((function e(t){var a,o,s,l;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=i[t]).peerId===r.id){e.next=9;break}return e.next=4,r.consumer(n.roomname,r.id,n.device.rtpCapabilities,n.consumerTransport,a.producerId);case 4:o=e.sent,(s=new MediaStream).addTrack(o.track),-1!==(l=c.findIndex((function(e){return e.peerId===a.peerId})))?"video"===o.track.kind?c[l].video.push({stream:s,consumerId:o.id}):c[l].audio={stream:s,consumerId:o.id}:"video"===o.track.kind?c.push({peerName:a.peername,peerId:a.peerId,video:[{stream:s,consumerId:o.id}],audio:null}):c.push({peerName:a.peername,peerId:a.peerId,video:[],audio:{stream:s,consumerId:o.id}});case 9:case"end":return e.stop()}}),e)})),l=0;case 15:if(!(l<i.length)){e.next=20;break}return e.delegateYield(s(l),"t0",17);case 17:l++,e.next=15;break;case 20:return e.next=22,a.props.setRemoteElement(c);case 22:console.log("vao day");case 23:case"end":return e.stop()}}),e)}))),a.onOpenMic=Object(Q.a)(K.a.mark((function e(){var t,n,r,o,i,c,s,l;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ke.micEnable=!0,t=window.roomClient,n=t.localUser,r={video:!1,audio:!0},o=navigator.mediaDevices,e.next=7,o.getUserMedia(r);case 7:return i=e.sent,c=i.getAudioTracks()[0],e.next=11,null===n||void 0===n?void 0:n.produce(t.routerCapabilities,t.producerTransport,c,"audio");case 11:s=e.sent,(l=Object(S.a)({},a.props.localElementState)).audio.push({producer:s,stream:i}),a.props.setLocalElementReducer(l);case 15:case"end":return e.stop()}}),e)}))),a.onStopMic=function(){ke.micEnable=!1;var e=window.roomClient.localUser,t=Object(S.a)({},a.props.localElementState);console.log(t);for(var n=0;n<t.videos.length;n++){var r=t.audio[n].producer;"audio"===r.producer.type&&(console.log("producerInstance"),null===e||void 0===e||e.closeProducer(r.producer))}},a.onOpenCamera=Object(Q.a)(K.a.mark((function e(){var t,n,r,o,i,c,s,l;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ke.cameraEnable=!0,t=window.roomClient,n=t.localUser,r={video:!0,audio:!1},o=navigator.mediaDevices,e.next=7,o.getUserMedia(r);case 7:return i=e.sent,c=i.getVideoTracks()[0],e.next=11,null===n||void 0===n?void 0:n.produce(t.routerCapabilities,t.producerTransport,c,"camera");case 11:s=e.sent,(l=Object(S.a)({},a.props.localElementState)).videos.push({producer:s,stream:i}),a.props.setLocalElementReducer(l);case 15:case"end":return e.stop()}}),e)}))),a.onStopCamera=function(){ke.cameraEnable=!1;for(var e=window.roomClient.localUser,t=Object(S.a)({},a.props.localElementState),n=0;n<t.videos.length;n++){var r=t.videos[n].producer;console.log(r.producer),"camera"===r.producer.type&&(null===e||void 0===e||e.closeProducer(r.producer))}console.log(e)},a.onStartScreenShare=Object(Q.a)(K.a.mark((function e(){var t,n,r,o,i,c,s,l;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.roomClient,n=t.localUser,r={video:!0,audio:!1},o=navigator.mediaDevices,e.next=6,o.getDisplayMedia(r);case 6:return i=e.sent,c=i.getVideoTracks()[0],e.next=10,null===n||void 0===n?void 0:n.produce(t.routerCapabilities,t.producerTransport,c,"screenshare");case 10:s=e.sent,(l=Object(S.a)({},a.props.localElementState)).screenCast.push({producer:s,stream:i}),a.props.setLocalElementReducer(l);case 14:case"end":return e.stop()}}),e)}))),a.onEndCall=function(){var e;null===(e=window.roomClient)||void 0===e||e.exit(!1),q.dispatch(b(!1))},a.onDisplayChat=Object(Q.a)(K.a.mark((function e(){var t,n;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("chatElement"),"none"!==t.style.display){e.next=10;break}return t.style.display="flex",e.next=6,Ue.post("/call/getMessageInRoom",{roomname:window.roomClient.roomname});case 6:n=e.sent,q.dispatch(P(n.data)),e.next=11;break;case 10:t.style.display="none";case 11:case"end":return e.stop()}}),e)}))),a.onDisplayRemote=function(){var e=document.getElementById("remoteVideos"),t=e.style.display;e.style.display="none"===t?"flex":"none"},a.onDisplayRoomInfo=Object(Q.a)(K.a.mark((function e(){var t;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue.post("/call/getRoomInfo",{roomname:window.roomClient.roomname,password:window.roomClient.password});case 2:t=e.sent,a.props.setModal({visible:!0,header:"Th\xf4ng tin cu\u1ed9c h\u1ecdp",render:Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(qe.a,{style:{margin:"5px 0"},children:Object(r.jsx)(Ge.a,{addonBefore:Object(r.jsx)(Je.a,{icon:Object(r.jsx)(Ke.a,{}),color:"#55acee",children:"T\xean ph\xf2ng:"}),placeholder:"Nh\u1eadp t\xean ph\xf2ng",disabled:!0,value:t.data.roomname})}),Object(r.jsx)(qe.a,{style:{margin:"5px 0"},children:Object(r.jsx)(Ge.a.Password,{onChange:function(e){ke.password=e.target.value},addonBefore:Object(r.jsx)(Je.a,{icon:Object(r.jsx)(Ke.a,{}),color:"#cd201f",children:"M\u1eadt kh\u1ea9u:"}),placeholder:"Nh\u1eadp m\u1eadt kh\u1ea9u",value:t.data.password})})]})});case 4:case"end":return e.stop()}}),e)}))),a.onShareLink=function(){Ve.a.info({title:"Li\xean k\u1ebft chia s\u1ebb",content:Object(r.jsx)("div",{children:Object(r.jsx)(Ge.a.Search,{id:"copyLink",onSearch:function(e){document.getElementById("copyLink").select(),document.execCommand("copy"),je.b.info(e)},allowClear:!0,enterButton:Object(r.jsx)(X.a,{"data-clipboard-target":"#copyLink",icon:Object(r.jsx)(Ze.a,{})}),value:window.location.href})}),footer:null})},a.linkInput=null,a}return Object(s.a)(n,[{key:"render",value:function(){var e=this.props,t=e.viewOneCamera,n=e.remoteElementState;return console.log("remoteElementState",n),Object(r.jsxs)(_e.a,{style:{height:"100%"},children:[Object(r.jsx)(Be,{}),Object(r.jsx)(rt,{style:{display:"none"},id:"chatElement",width:350,onClick:this.onCreateRoom,children:Object(r.jsx)(tt,{})}),Object(r.jsxs)(_e.a,{children:[t?Object(r.jsx)(at,{id:"localMedia",children:Object(r.jsxs)(_e.a,{style:{height:"100%"},children:[Object(r.jsx)(rt,{width:150,id:"localVideos",style:{position:"absolute",zIndex:2,background:"transparent"},children:Object(r.jsx)(Ce,{})}),Object(r.jsx)(at,{style:{overflow:"hidden"},id:"localMedia",children:Object(r.jsx)(fe,{})})]})}):Object(r.jsx)(at,{id:"multipleMedia",children:Object(r.jsx)(_e.a,{style:{height:"100%"},children:Object(r.jsx)(ze,{})})}),Object(r.jsx)(nt,{children:Object(r.jsx)(Te,{onStopMic:this.onStopMic,onOpenMic:this.onOpenMic,onDisplayChat:this.onDisplayChat,onStartScreenShare:this.onStartScreenShare,onEndCall:this.onEndCall,onStopCamera:this.onStopCamera,onOpenCamera:this.onOpenCamera,onDisplayRemote:this.onDisplayRemote,onDisplayRoomInfo:this.onDisplayRoomInfo,onShareLink:this.onShareLink})})]}),t?Object(r.jsx)(rt,{style:{background:"#f0f2f5",width:"100%",display:n.length>0?"block":"none"},width:220,id:"remoteVideos",children:Object(r.jsx)(ue,{})}):null]})}}]),n}(a.Component);var it=Object(G.b)((function(e){return{viewOneCamera:e.ui.viewOneCamera,remoteElementState:e.remoteElementState,localElementState:e.localElementState}}),(function(e){return{setModal:function(t){return e(_(t))},setLocalElementReducer:function(t){return e(W(t))},setRemoteElement:function(t){return e(U(t))}}}))(ot),ct=(a.Component,n(216)),st="audio",lt="video",dt=function e(t,n,r,a,o){var i=this;Object(c.a)(this,e),this.produce=function(){var e=Object(Q.a)(K.a.mark((function e(t,n,r,a){var o,c,s;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.getTrackParamsCodec(t,r),e.next=3,n.produce(o);case 3:return(c=e.sent).type=a,c.on("trackended",(function(){console.log("producer trackend"),i.closeProducer(c)})),c.on("transportclose",(function(){console.log("producer transport close")})),c.on("close",(function(){console.log("closing producer")})),s={kind:c.kind,id:c.id,producer:c},e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),this.consumer=function(){var e=Object(Q.a)(K.a.mark((function e(t,n,r,a,o){var i,c,s,l,d,u,p;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue.post("/call/createConsumer",{roomname:t,userId:n,consumerParams:{rtpCapabilities:r,consumerTransportId:a.id,producerId:o}});case 2:return i=e.sent,c=i.data.params,s=c.id,l=c.kind,d=c.rtpParameters,u=[{ssrc:222220,scalabilityMode:"S4T1"}],e.next=7,a.consume({id:s,producerId:o,kind:l,rtpParameters:d,codecOptions:u});case 7:return p=e.sent,e.abrupt("return",p);case 9:case"end":return e.stop()}}),e)})));return function(t,n,r,a,o){return e.apply(this,arguments)}}(),this.getTrackParamsCodec=function(e,t){switch(t.kind){case lt:return{track:t,codec:e.codecs.find((function(e){return"video/vp8"===e.mimeType.toLowerCase()}))};case st:return{track:t,codec:e.codecs.find((function(e){return"audio/opus"===e.mimeType.toLowerCase()}))}}},this.closeProducer=function(){var e=Object(Q.a)(K.a.mark((function e(t){var n,r,a,o;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue.post("/call/closeProducer",{roomname:i.roomname,userId:i.id,producerParams:{producerId:t.id}});case 2:if(n=Object(S.a)({},q.getState().localElementState),"camera"===t.type)for(r=0;r<n.videos.length;r++)n.videos[r].producer.id===t.id&&n.videos.splice(r,1);else if("screenshare"===t.type)for(a=0;a<n.screenCast.length;a++)n.screenCast[a].producer.id===t.id&&n.screenCast.splice(a,1);else for(o=0;o<n.audio.length;o++)n.audio[o].producer.id===t.id&&n.audio.splice(o,1);q.dispatch(W(n));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.closeProducerWithType=function(){var e=Object(Q.a)(K.a.mark((function e(t){var n,r,a,o,c,s,l;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(S.a)({},q.getState().localElementState),"camera"!==t){e.next=13;break}r=0;case 3:if(!(r<n.videos.length)){e.next=11;break}return a=n.videos[r],e.next=7,Ue.post("/call/closeProducer",{roomname:i.roomname,userId:i.id,producerParams:{producerId:a.producer.id}});case 7:n.videos=[];case 8:r++,e.next=3;break;case 11:e.next=34;break;case 13:if("screenshare"!==t){e.next=25;break}o=0;case 15:if(!(o<n.screenCast.length)){e.next=23;break}return c=n.screenCast[o],e.next=19,Ue.post("/call/closeProducer",{roomname:i.roomname,userId:i.id,producerParams:{producerId:c.producer.id}});case 19:n.screenCast=[];case 20:o++,e.next=15;break;case 23:e.next=34;break;case 25:s=0;case 26:if(!(s<n.audio.length)){e.next=34;break}return l=n.audio[s],e.next=30,Ue.post("/call/closeProducer",{roomname:i.roomname,userId:i.id,producerParams:{producerId:l.producer.id}});case 30:n.audio=[];case 31:s++,e.next=26;break;case 34:q.dispatch(W(n));case 35:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.closeConsumer=function(e){for(var t=Object(Z.a)(q.getState().remoteElementState),n=0;n<t.length;n++){var r,a=t[n];if((null===(r=a.audio)||void 0===r?void 0:r.consumerId)===e)a.audio=null;else for(var o=0;o<a.video.length;o++){a.video[o].consumerId===e&&a.video.splice(o,1)}}console.log(e,t),q.dispatch(U(t))},this.closeAddConsumerOfUser=function(e){var t=Object(Z.a)(q.getState().remoteElementState).filter((function(t){return t.peerId!==e}));q.dispatch(U(t))},this.socket=t,this.id=n,this.username=r,this.iskey=a,this.roomname=o},ut="producer",pt="consumer",mt=function e(t,n,r,a){var o=this;Object(c.a)(this,e),this.initSocketEvent=function(){o.socket.on(ge,function(){var e=Object(Q.a)(K.a.mark((function e(t){var n,r,a,i;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(Z.a)(q.getState().remoteElementState),e.next=3,o.localUser.consumer(o.roomname,o.localUser.id,o.device.rtpCapabilities,o.consumerTransport,t.producer_id);case 3:return r=e.sent,(a=new MediaStream).addTrack(r.track),-1!==(i=n.findIndex((function(e){return e.peerId===t.peerId})))?"video"===r.track.kind?n[i].video.push({consumerId:r.id,stream:a}):n[i].audio={consumerId:r.id,stream:a}:"video"===r.track.kind?n.push({peerName:t.peerName,peerId:t.peerId,video:[{consumerId:r.id,stream:a}],audio:null}):n.push({peerName:t.peerName,peerId:t.peerId,video:[],audio:{consumerId:r.id,stream:a}}),e.next=10,q.dispatch(U(n));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.socket.on(ye,(function(e){var t=e.consumerId,n=e.peerId,r=e.peerName;console.log("closing consumer:",t,n,r),o.localUser.closeConsumer(t,n,r)})),o.socket.on(be,function(){var e=Object(Q.a)(K.a.mark((function e(t){var n,r;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.name,r=t.id,o.localUser.closeAddConsumerOfUser(r),m("warning",n+" \u0111\xe3 r\u1eddi kh\u1ecfi cu\u1ed9c h\u1ecdp");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.socket.on(Oe,function(){var e=Object(Q.a)(K.a.mark((function e(t){var n;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.name,t.id,m("info",n+" \u0111\xe3 tham gia v\xe0o cu\u1ed9c h\u1ecdp");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.socket.on(xe,(function(e){q.dispatch(P(e))})),o.socket.on(ve,(function(){o.exit(!1)}))},this.exit=Object(Q.a)(K.a.mark((function e(){var t=arguments;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length>0&&void 0!==t[0]&&t[0]){e.next=4;break}return e.next=4,Ue.post("/call/exitRoom",{roomname:o.roomname,userId:o.localUser.id});case 4:o.consumerTransport.close(),o.producerTransport.close(),o.socket.off(Oe),o.socket.off(be),o.socket.off(ve),o.socket.off(ye),o.socket.off(ge),window.close();case 12:case"end":return e.stop()}}),e)}))),this.init=Object(Q.a)(K.a.mark((function e(){var t,n,r,a,i;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new dt(o.socket,o.socket.id,o.username,!0,o.roomname),e.next=3,Ue.post("/call/checkRoomExistence",{roomname:o.roomname});case 3:if(!e.sent){e.next=14;break}return t.iskey=!1,e.next=8,o.joinRoom(t);case 8:if(1===e.sent.status){e.next=11;break}return e.abrupt("return");case 11:console.log("join room"),e.next=21;break;case 14:return t.iskey=!0,e.next=17,o.createRoom(t);case 17:if(1===e.sent.status){e.next=20;break}return e.abrupt("return");case 20:console.log("create room");case 21:return e.next=23,Ue.post("/call/getRouterCapacities",{roomname:o.roomname});case 23:return n=e.sent,r=n.data,e.next=27,o.loadDevice(r);case 27:return o.device=e.sent,e.next=30,o.initTransports(o.device,ut);case 30:return a=e.sent,console.log(a),a.on("connect",function(){var e=Object(Q.a)(K.a.mark((function e(t,n,r){return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ue.post("/call/connectTransport",{roomname:o.roomname,userId:o.socket.id,connectTransport:{dtlsParameters:t.dtlsParameters,transportId:a.id}});case 3:n(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),r(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n,r){return e.apply(this,arguments)}}()),a.on("produce",function(){var e=Object(Q.a)(K.a.mark((function e(t,n,r){var i,c,s,l;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=t.kind,c=t.rtpParameters,e.next=4,Ue.post("/call/createProducer",{roomname:o.roomname,userId:o.socket.id,producerParams:{producerTransportId:a.id,kind:i,rtpParameters:c}});case 4:s=e.sent,l=s.data,n({id:l}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n,r){return e.apply(this,arguments)}}()),e.next=36,o.initTransports(o.device,pt);case 36:(i=e.sent).on("connect",function(){var e=Object(Q.a)(K.a.mark((function e(t,n,r){return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ue.post("/call/connectTransport",{roomname:o.roomname,userId:o.socket.id,connectTransport:{dtlsParameters:t.dtlsParameters,transportId:i.id}});case 3:console.log("connectconsumer"),n(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r(r);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}()),o.producerTransport=a,o.consumerTransport=i,o.routerCapabilities=r,o.localUser=t;case 42:case"end":return e.stop()}}),e)}))),this.getProducerInRoom=Object(Q.a)(K.a.mark((function e(){var t;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue.post("/call/getProducerInRoom",{roomname:o.roomname});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),this.createRoom=function(){var e=Object(Q.a)(K.a.mark((function e(t){var n;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue.post("/call/createRoom",{roomname:o.roomname,password:o.password,userId:t.id,username:t.username});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.joinRoom=function(){var e=Object(Q.a)(K.a.mark((function e(t){var n;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,Ue.post("/call/joinRoom",{roomname:o.roomname,password:o.password,userId:t.id,username:t.username});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.loadDevice=function(){var e=Object(Q.a)(K.a.mark((function e(t){var n;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n=new ct.Device}catch(r){"UnsupportedError"===r.name&&console.error("browser not supported"),console.error(r)}return e.next=3,n.load({routerRtpCapabilities:t});case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.initTransports=function(){var e=Object(Q.a)(K.a.mark((function e(t,n){var r,a,i,c;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.roomname,a=o.socket.id,e.next=4,Ue.post("/call/createTransport",{roomname:r,userId:a});case 4:if(1!==(i=e.sent).status){e.next=8;break}return c=n==ut?t.createSendTransport(i.data):t.createRecvTransport(i.data),e.abrupt("return",c);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.produce=function(){var e=Object(Q.a)(K.a.mark((function e(t,n){var r,a;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(n.kind),r={track:n,codec:o.device.rtpCapabilities.codecs.find((function(e){return"video/vp8"===e.mimeType.toLowerCase()})),encodings:[{rid:"r0",scalabilityMode:"S1T3"},{rid:"r1",scalabilityMode:"S1T3"},{rid:"r2",scalabilityMode:"S1T3"},{rid:"r3",scalabilityMode:"S1T3"}],codecOptions:{videoGoogleStartBitrate:1e3}},e.next=4,t.produce(r);case 4:a=e.sent,{kind:a.kind,id:a.id,producer:a};case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.consumer=function(){var e=Object(Q.a)(K.a.mark((function e(t,n){var r,a,i,c,s,l,d,u,p,m,h;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.device.rtpCapabilities,e.next=3,Ue.post("/call/createConsumer",{roomname:o.roomname,userId:o.socket.id,consumerParams:{rtpCapabilities:a,consumerTransportId:t.id,producerId:n}});case 3:return i=e.sent,c=i.data.params,s=c.id,l=c.kind,d=c.rtpParameters,u=[{ssrc:222220,scalabilityMode:"S4T1"}],e.next=8,t.consume({id:s,producerId:n,kind:l,rtpParameters:d,codecOptions:u});case 8:p=e.sent,(m=new MediaStream).addTrack(p.track),(h=document.createElement("video")).srcObject=m,h.style.width="512px",h.style.height="512px",h.style.background="black",h.style.float="left",h.autoplay=!0,null===(r=document.getElementById("container"))||void 0===r||r.append(h);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.roomname=t,this.password=n,this.username=r,this.socket=Object(u.io)("".concat(window.location.protocol,"//").concat(window.serverIp,":").concat(window.port)),console.log("".concat(window.location.protocol,"//").concat(window.serverIp,":").concat(window.port)),this.socket.on("connect",(function(){o.socket.abc="dsddd",a(o)})),this.localUser=null},ht={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,r,a,o,i,c,s="",l=0;for(e=ht._utf8_encode(e);l<e.length;)a=(t=e.charCodeAt(l++))>>2,o=(3&t)<<4|(n=e.charCodeAt(l++))>>4,i=(15&n)<<2|(r=e.charCodeAt(l++))>>6,c=63&r,isNaN(n)?i=c=64:isNaN(r)&&(c=64),s=s+this._keyStr.charAt(a)+this._keyStr.charAt(o)+this._keyStr.charAt(i)+this._keyStr.charAt(c);return s},decode:function(e){var t,n,r,a,o,i,c="",s=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");s<e.length;)t=this._keyStr.indexOf(e.charAt(s++))<<2|(a=this._keyStr.indexOf(e.charAt(s++)))>>4,n=(15&a)<<4|(o=this._keyStr.indexOf(e.charAt(s++)))>>2,r=(3&o)<<6|(i=this._keyStr.indexOf(e.charAt(s++))),c+=String.fromCharCode(t),64!=o&&(c+=String.fromCharCode(n)),64!=i&&(c+=String.fromCharCode(r));return c=ht._utf8_decode(c)},_utf8_encode:function(e){var t="";e=e.replace(/\r\n/g,"\n");for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){var t,n,r,a="",o=0;for(t=n=0;o<e.length;)(t=e.charCodeAt(o))<128?(a+=String.fromCharCode(t),o++):t>191&&t<224?(n=e.charCodeAt(o+1),a+=String.fromCharCode((31&t)<<6|63&n),o+=2):(n=e.charCodeAt(o+1),r=e.charCodeAt(o+2),a+=String.fromCharCode((15&t)<<12|(63&n)<<6|63&r),o+=3);return a}},ft=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){var e=new URL(window.location.href).searchParams.get("option");if(e){var t=ht.decode(e),n=JSON.parse(t);r.formRef.setFieldsValue({roomName:n.roomname,displayName:n.username,password:n.roomKey})}},r.onFinish=function(e){ke.micEnable=r.state.micEnable,ke.cameraEnable=r.state.cameraEnable;var t=e.roomName,n=e.displayName,a=e.password;r.onCreateRoom(t,n,a)},r.onCreateRoom=function(e,t,n){new mt(e,n,t,function(){var e=Object(Q.a)(K.a.mark((function e(t){return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.init();case 2:return e.next=4,t.initSocketEvent();case 4:window.roomClient=t,r.props.setRoomCreate(!0);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},r.state={micEnable:!1,cameraEnable:!0},r}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsx)("div",{style:{display:"flex",width:"100%",height:"100%",alignItems:"center",justifyContent:"center"},children:this.props.roomCreateState?Object(r.jsx)(it,{}):Object(r.jsx)("div",{children:Object(r.jsxs)(Ye.a,{ref:function(t){return e.formRef=t},name:"control-ref",onFinish:this.onFinish,children:[Object(r.jsx)(Ye.a.Item,{name:"roomName",label:"T\xean cu\u1ed9c h\u1ecdp",rules:[{required:!0}],children:Object(r.jsx)(Ge.a,{})}),Object(r.jsx)(Ye.a.Item,{name:"displayName",label:"T\xean hi\u1ec3n th\u1ecb",rules:[{required:!0}],children:Object(r.jsx)(Ge.a,{})}),Object(r.jsx)(Ye.a.Item,{name:"password",label:"M\u1eadt kh\u1ea9u cu\u1ed9c h\u1ecdp",children:Object(r.jsx)(Ge.a,{})}),Object(r.jsxs)(Ye.a.Item,{children:[Object(r.jsx)(X.a,{onClick:function(){e.setState({micEnable:!e.state.micEnable})},icon:this.state.micEnable?Object(r.jsx)("i",{className:"material-icons",children:"mic"}):Object(r.jsx)("i",{className:"material-icons",children:"mic_off"})}),Object(r.jsx)(X.a,{onClick:function(){e.setState({cameraEnable:!e.state.cameraEnable})},icon:this.state.cameraEnable?Object(r.jsx)("i",{className:"material-icons",children:"videocam"}):Object(r.jsx)("i",{className:"material-icons",children:"videocam_off"})})]}),Object(r.jsx)(Ye.a.Item,{children:Object(r.jsx)(X.a,{type:"primary",htmlType:"submit",children:"T\u1ea1o cu\u1ed9c h\u1ecdp/Tham gia v\xe0o cu\u1ed9c h\u1ecdp"})})]})})})}}]),n}(a.Component);var jt=Object(G.b)((function(e){return{roomCreateState:e.roomCreateState}}),(function(e){return{setRoomCreate:function(t){return e(b(t))}}}))(ft),vt=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){},r.name="Dr.admin",window.name=r.name,(Ue=We.a.create({timeout:6e6,baseURL:"".concat(window.location.protocol,"//").concat(window.serverIp,":").concat(window.port)})).interceptors.request.use((function(e){return e})),Ue.interceptors.response.use((function(e){return null===e||void 0===e?void 0:e.data}),(function(e){return Promise.reject(e)})),r}return Object(s.a)(n,[{key:"render",value:function(){return console.log(q.getState()),Object(r.jsx)(G.a,{store:q,children:Object(r.jsx)("div",{style:{width:"100%",height:"100vh"},children:Object(r.jsx)(jt,{})})})}}]),n}(a.Component),bt=(n(436),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,453)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),o(e),i(e)}))});i.a.render(Object(r.jsx)(vt,{}),document.getElementById("root")),bt()}},[[437,1,2]]]);
//# sourceMappingURL=main.aa0417f1.chunk.js.map